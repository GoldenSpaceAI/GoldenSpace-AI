<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Refund Golden Coins - GoldenSpaceAI</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif;}
    body{
      background:linear-gradient(135deg,#0c0c2e 0%,#1a1a4a 50%,#2d1b69 100%);
      color:#e7f4e9;min-height:100vh;padding:20px;
    }
    .container{max-width:600px;margin:0 auto;}
    .header{text-align:center;margin-bottom:30px;padding:20px;}
    .logo{font-size:2.5rem;font-weight:bold;color:#f6c64a;margin-bottom:10px;}
    .tagline{color:#cfc6a5;font-size:1.2rem;}
    .refund-card{
      background:linear-gradient(135deg,#0f1624,#0b1320);
      border:1px solid #1f2a40;border-radius:20px;padding:30px;
      box-shadow:0 20px 40px rgba(0,0,0,0.3);margin-bottom:40px;
    }
    .card-title{text-align:center;color:#f6c64a;font-size:1.8rem;margin-bottom:25px;}
    .balance-info{background:rgba(246,198,74,0.1);border:1px solid rgba(246,198,74,0.3);border-radius:12px;padding:20px;text-align:center;margin-bottom:25px;}
    .balance-amount{font-size:2.4rem;font-weight:bold;color:#f6c64a;}
    .form-group{margin-bottom:20px;}
    .form-label{color:#cfc6a5;margin-bottom:8px;display:block;font-weight:600;}
    .form-input{width:100%;padding:15px;border-radius:10px;border:2px solid #1f2a40;background:#0a1120;color:#e7f4e9;font-size:1rem;}
    .form-input:focus{outline:none;border-color:#f6c64a;box-shadow:0 0 0 3px rgba(246,198,74,0.2);}
    .refund-options{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px;}
    .refund-option{padding:15px;text-align:center;border:2px solid #1f2a40;border-radius:10px;background:rgba(255,255,255,0.05);cursor:pointer;}
    .refund-option.selected{border-color:#f6c64a;background:rgba(246,198,74,0.1);}
    .submit-btn{
      width:100%;padding:18px 30px;border:none;border-radius:12px;
      background:linear-gradient(135deg,#f6c64a,#eb8b36);color:#1a1300;
      font-size:1.2rem;font-weight:bold;cursor:pointer;transition:all .3s ease;margin-top:10px;
    }
    .submit-btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(246,198,74,.4);}
    .loading{text-align:center;margin-top:20px;display:none;}
    .loading-spinner{border:3px solid #f3f3f3;border-top:3px solid #f6c64a;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:0 auto;}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .notification{
      position:fixed;top:20px;right:20px;padding:15px 20px;border-radius:8px;
      background:#28a745;color:white;box-shadow:0 5px 15px rgba(0,0,0,.3);
      display:none;z-index:1000;
    }
    .action-links{display:flex;gap:10px;justify-content:center;margin-top:30px;}
    .action-link{color:#f6c64a;border:1px solid #f6c64a;padding:10px 20px;border-radius:8px;text-decoration:none;}
    .action-link:hover{background:rgba(246,198,74,0.1);}
    @media(max-width:768px){.refund-options{grid-template-columns:1fr;}.action-links{flex-direction:column;align-items:center;}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">üí∞ GoldenSpaceAI</div>
      <div class="tagline">Refund Your Golden Coins</div>
    </div>

    <div class="refund-card">
      <h1 class="card-title">Request a Refund</h1>
      <div class="balance-info">
        <div>Your Current Golden Balance</div>
        <div class="balance-amount" id="userBalance">0G</div>
      </div>

      <form id="refundForm">
        <div class="form-group">
          <label class="form-label">Amount of Golden to Refund</label>
          <input type="number" id="goldenAmount" class="form-input" min="1" placeholder="Enter amount (e.g., 20)" required />
        </div>

        <div class="form-group">
          <label class="form-label">Select Refund Currency</label>
          <div class="refund-options">
            <div class="refund-option" data-currency="BTC">‚Çø Bitcoin</div>
            <div class="refund-option" data-currency="LTC">≈Å Litecoin</div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" id="walletLabel">Bitcoin (BTC) Wallet Address</label>
          <input type="text" id="walletAddress" class="form-input" placeholder="Enter your BTC wallet address" required />
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">REQUEST REFUND</button>

        <div class="loading" id="loading">
          <div class="loading-spinner"></div>
          <div>Processing your refund request...</div>
        </div>
      </form>
    </div>

    <div class="action-links">
      <a href="/" class="action-link">üè† Home</a>
      <a href="/buy-golden.html" class="action-link">üí∞ Buy Golden</a>
    </div>
  </div>

  <div class="notification" id="notification">Refund submitted!</div>

  <script>
    let selectedCurrency = 'BTC';
    let userBalance = 0;

    // Load balance
    async function loadUserBalance() {
      try {
        const res = await fetch("/api/golden-balance", { credentials: "include" });
        const data = await res.json();
        if (!data.loggedIn) {
          location.href = "/login-signup.html";
          return;
        }
        userBalance = data.balance;
        document.getElementById("userBalance").textContent = userBalance + "G";
      } catch (e) {
        console.error(e);
      }
    }

    // Currency selection
    document.querySelectorAll(".refund-option").forEach(opt=>{
      opt.addEventListener("click",()=>{
        document.querySelectorAll(".refund-option").forEach(o=>o.classList.remove("selected"));
        opt.classList.add("selected");
        selectedCurrency = opt.dataset.currency;
        document.getElementById("walletLabel").textContent = selectedCurrency==="BTC"?"Bitcoin (BTC) Wallet Address":"Litecoin (LTC) Wallet Address";
        document.getElementById("walletAddress").placeholder = selectedCurrency==="BTC"?"Enter your BTC wallet address":"Enter your LTC wallet address";
      });
    });

    // Submit refund
    document.getElementById("refundForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const amount = parseInt(document.getElementById("goldenAmount").value);
      const walletAddress = document.getElementById("walletAddress").value.trim();
      if(!amount || amount<1) return showNotification("Enter a valid refund amount");
      if(amount>userBalance) return showNotification("Not enough Golden balance");
      if(!walletAddress) return showNotification("Enter your wallet address");

      showLoading(true);
      try {
        const res = await fetch("/api/refund-golden", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          credentials:"include",
          body:JSON.stringify({amount, currency:selectedCurrency, walletAddress})
        });
        const data = await res.json();
        if(!res.ok) throw new Error(data.error || "Refund failed");

        showNotification("‚úÖ Refund submitted successfully! RefundID:2233553");
        loadUserBalance();
        document.getElementById("refundForm").reset();
      } catch(err){
        console.error(err);
        showNotification("‚ùå "+err.message);
      } finally {
        showLoading(false);
      }
    });

    function showLoading(show){
      document.getElementById("loading").style.display=show?"block":"none";
      document.getElementById("submitBtn").disabled=show;
      document.getElementById("submitBtn").textContent=show?"PROCESSING...":"REQUEST REFUND";
    }
    function showNotification(msg){
      const n=document.getElementById("notification");
      n.textContent=msg;n.style.display="block";
      setTimeout(()=>n.style.display="none",5000);
    }

    document.addEventListener("DOMContentLoaded",()=>{
      loadUserBalance();
      document.querySelector('[data-currency="BTC"]').classList.add("selected");
    });
  </script>
</body>
</html>
