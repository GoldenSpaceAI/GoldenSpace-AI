<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#0a0e15"/>
  <title>GoldenSpaceAI • My Planets</title>
  <link rel="icon" href="/favicon.ico"/>
  <style>
    :root{
      --bg:#0a0e15; --panel:#0f1624; --panel2:#0b1320; --border:#1f2a40;
      --text:#e7f4e9; --muted:#cfc6a5; --gold:#f6c64a; --gold2:#eb8b36;
      --shadow:0 22px 70px rgba(0,0,0,.55); --radius:18px; --max:1150px;
      --ok:#2fe68a; --warn:#ffd166; --err:#ff7171;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;color:var(--text);
      font:16px/1.6 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        linear-gradient(180deg, rgba(10,14,21,.55), rgba(10,14,21,.7)),
        radial-gradient(1200px 720px at 75% -10%, rgba(246,198,74,.22), transparent 65%),
        url("https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?q=80&w=1920&auto=format&fit=crop") center/cover fixed no-repeat;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit;text-decoration:none}

    .top{position:sticky;top:0;z-index:30;backdrop-filter:blur(10px);
      background:linear-gradient(180deg, rgba(10,14,21,.85), rgba(10,14,21,.5) 60%, transparent);
      border-bottom:1px solid var(--border); padding:max(12px,env(safe-area-inset-top)) 16px 10px;
      display:flex; align-items:center; gap:12px;}
    .brand{display:flex; align-items:center; gap:10px; font-weight:900; color:var(--gold);
      font-size:clamp(20px,2.2vw,26px); text-shadow:0 0 16px rgba(246,198,74,.25)}
    .dot{width:10px;height:10px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #ffd86a, #f6c64a 50%, #eb8b36 90%);
      box-shadow:0 0 18px rgba(246,198,74,.5);}
    .pill{margin-left:auto;display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);
      border-radius:999px;padding:6px 10px;color:var(--muted);font-size:12px}

    .wrap{max-width:var(--max);margin:22px auto;padding:0 16px}
    h1{margin:8px 0 12px; font-size:clamp(22px,4.4vw,34px); color:#fff6d8}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 16px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:10px 14px;border-radius:12px;border:1px solid rgba(0,0,0,.25);font-weight:900;cursor:pointer}
    .btn.gold{background:linear-gradient(180deg,var(--gold),var(--gold2));color:#1c1500;box-shadow:0 10px 26px rgba(246,198,74,.25)}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid var(--border)}
    .btn.small{padding:8px 10px;font-size:13px}
    .status{margin-left:auto;opacity:.9;font-size:12px;color:#cfe0ff}

    .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill, minmax(260px, 1fr))}
    .card{
      background:linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:14px;
      display:grid; gap:10px;
    }
    .name{font-weight:900;font-size:16px;color:#fff7dc}
    .meta{font-size:12px;color:#bcd0f0}
    .json{font:12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color:#dfe7f1;
      background:#0b1322; border:1px solid var(--border); border-radius:12px; padding:10px; max-height:150px; overflow:auto}
    .actions{display:flex;gap:8px;flex-wrap:wrap}

    .empty{
      background:linear-gradient(180deg, rgba(246,198,74,.08), rgba(246,198,74,.02));
      border:1px solid rgba(246,198,74,.28); border-radius:14px; padding:14px; color:#f7efd1; margin-top:10px;
    }
    footer{max-width:var(--max);margin:26px auto 34px;padding:0 16px;color:#aeb7c5;font-size:12px;
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;border-top:1px solid var(--border);padding-top:12px}
    :focus-visible{outline:2px solid var(--gold);outline-offset:2px;border-radius:8px}
  </style>
</head>
<body>
  <div class="top">
    <div class="brand"><span class="dot"></span> GoldenSpaceAI</div>
    <a class="pill" href="/">← Back to Home</a>
  </div>

  <main class="wrap" aria-label="My Planets">
    <h1>My Planets</h1>
    <div class="toolbar">
      <button class="btn gold" id="importBtn">Import JSON</button>
      <button class="btn ghost" id="exportAllBtn">Export All</button>
      <button class="btn ghost" id="clearAllBtn">Delete All</button>
      <span class="status" id="status">Loading…</span>
      <input type="file" id="fileInput" accept="application/json" style="display:none"/>
    </div>

    <section id="list" class="grid"></section>

    <div id="empty" class="empty" style="display:none;">
      <div style="font-weight:900;">No planets saved yet.</div>
      <div style="margin-top:6px;">Build one in <a href="/create-advanced-planet.html" style="color:#f6c64a;font-weight:800">Create Advanced Planet</a>, then it will appear here.</div>
    </div>
  </main>

  <footer>
    <div>©️ <span id="yr"></span> GoldenSpaceAI</div>
    <div>
      <a href="/privacy.html">Privacy</a> ·
      <a href="/terms.html">Terms</a> ·
      <a href="/refund.html">Refund Policy</a>
    </div>
  </footer>

  <script>
    document.getElementById('yr').textContent = new Date().getFullYear();

    let yourSpace = false;
    let planets = [];

    async function loadMe(){
      try{
        const r = await fetch('/api/me', { credentials:'include' });
        const me = await r.json();
        yourSpace = !!(me?.features?.yourSpace);
        document.getElementById('status').textContent =
          `Plan: ${(me?.plan || '—').toUpperCase()} · Your Space: ${yourSpace ? 'YES' : 'NO'}`;
      }catch(e){
        document.getElementById('status').textContent = 'Not signed in';
      }
    }

    function loadLocal(){
      try{
        planets = JSON.parse(localStorage.getItem('advancedPlanets') || '[]');
      }catch{ planets = []; }
    }

    function saveLocal(){
      localStorage.setItem('advancedPlanets', JSON.stringify(planets));
    }

    function exportJSON(filename, dataObj){
      const blob = new Blob([JSON.stringify(dataObj, null, 2)], { type:'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function renderList(){
      const list = document.getElementById('list');
      const empty = document.getElementById('empty');
      list.innerHTML = '';

      if(!planets.length){
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      planets.forEach((p, idx)=>{
        const card = document.createElement('article');
        card.className = 'card';
        const created = p.createdAt ? new Date(p.createdAt) : null;

        card.innerHTML = `
          <div class="name">${p.name || 'Unnamed Planet'}</div>
          <div class="meta">
            Size: ${p.size || '—'} · Temp: ${p.temp ?? '—'}°C · Water: ${p.water ?? '—'}% · Life: ${p.life || '—'}
            ${created ? ` · Created: ${created.toLocaleString()}` : ''}
          </div>
          <pre class="json">${escapeHtml(JSON.stringify(p, null, 2))}</pre>
          <div class="actions">
            <button class="btn small gold" data-action="export" data-idx="${idx}">Export</button>
            <button class="btn small ghost" data-action="rename" data-idx="${idx}">Rename</button>
            <button class="btn small ghost" data-action="delete" data-idx="${idx}">Delete</button>
            ${yourSpace ? `<button class="btn small gold" data-action="toUniverse" data-idx="${idx}">Add to Your Universe →</button>` : ''}
          </div>
        `;
        list.appendChild(card);
      });
    }

    function escapeHtml(s){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    document.getElementById('list').addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-action]');
      if(!btn) return;
      const action = btn.dataset.action;
      const idx = Number(btn.dataset.idx);
      const p = planets[idx];

      if(action === 'export'){
        exportJSON(`${(p.name || 'planet').replace(/\s+/g,'_')}.json`, p);
      } else if(action === 'rename'){
        const name = prompt('New planet name:', p.name || '');
        if(name !== null){
          planets[idx].name = name.trim();
          saveLocal(); renderList();
        }
      } else if(action === 'delete'){
        if(confirm('Delete this planet?')){
          planets.splice(idx, 1);
          saveLocal(); renderList();
        }
      } else if(action === 'toUniverse'){
        try{
          localStorage.setItem('yourspace:lastPlanet', JSON.stringify(p));
          window.location.href = '/your-space.html';
        }catch{
          alert('Could not hand off to Your Space.');
        }
      }
    });

    // Toolbar actions
    document.getElementById('exportAllBtn').addEventListener('click', ()=>{
      if(!planets.length) return alert('No planets to export.');
      exportJSON('my_planets.json', planets);
    });

    document.getElementById('clearAllBtn').addEventListener('click', ()=>{
      if(!planets.length) return alert('Nothing to delete.');
      if(confirm('Delete ALL saved planets?')){
        planets = []; saveLocal(); renderList();
      }
    });

    document.getElementById('importBtn').addEventListener('click', ()=>{
      document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const data = JSON.parse(reader.result);
          if(Array.isArray(data)){
            planets = data;
          }else{
            planets.push(data);
          }
          saveLocal(); renderList();
          alert('Import successful.');
        }catch{
          alert('Invalid JSON.');
        }
      };
      reader.readAsText(file);
      e.target.value = '';
    });

    // Init
    (async function init(){
      await loadMe();
      loadLocal();
      renderList();
    })();
  </script>
</body>
</html>
