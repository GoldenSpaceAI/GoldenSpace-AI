<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Space - Universe Hub | GoldenSpaceAI</title>
    <style>
        :root {
            --bg-dark: #0a0e15;
            --panel-bg: #101828;
            --border-color: #334155;
            --text-primary: #E2E8F0;
            --text-secondary: #94A3B8;
            --gold-accent: #f6c64a;
            --gold-glow: rgba(246, 198, 74, 0.2);
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- Creation Screen --- */
        #creation-screen {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .creation-box {
            background-color: var(--panel-bg);
            padding: 3rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .creation-box h1 { color: var(--gold-accent); }
        .form-group { margin: 1.5rem 0; text-align: left; }
        .form-group label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); }
        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            background-color: var(--bg-dark);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 6px;
        }
        #create-universe-btn {
            background-color: var(--gold-accent);
            color: var(--bg-dark);
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
        }

        /* --- Sandbox Screen --- */
        #sandbox-screen {
            display: none; /* Initially hidden */
            width: 100%;
            height: 100%;
        }

        .toolbox {
            position: absolute;
            top: 0; left: 0;
            width: 280px;
            height: 100vh;
            background-color: var(--panel-bg);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem;
            z-index: 20;
            display: flex;
            flex-direction: column;
        }
        .toolbox h2, .toolbox h3 { color: var(--gold-accent); }
        .tool-item {
            display: flex; align-items: center; gap: 1rem; padding: 0.75rem;
            border-radius: 6px; margin-bottom: 1rem; cursor: pointer;
            border: 1px solid var(--border-color); transition: all 0.2s ease;
        }
        .tool-item:hover { border-color: var(--gold-accent); background-color: #1E293B; }
        .tool-item-icon { font-size: 2rem; line-height: 1; }
        .tool-item h3 { margin: 0; font-size: 1rem; color: var(--text-primary); }

        #inspector-panel {
            margin-top: auto; background-color: var(--bg-dark); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 1rem; display: none;
        }
        .inspector-group { margin-bottom: 1rem; }
        .inspector-group label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); }
        .inspector-group input, .inspector-group select {
            width: 100%; background-color: var(--panel-bg); border: 1px solid var(--border-color);
            color: var(--text-primary); padding: 0.5rem; border-radius: 4px; box-sizing: border-box;
        }
        .inspector-section { display: none; }

        .universe-canvas {
            width: 100%; height: 100%;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }
        .universe-canvas:active { cursor: grabbing; }

        #canvas-content {
            position: absolute;
            transform-origin: 0 0;
            transition: transform 0.2s ease-out;
        }

        .celestial-object {
            position: absolute;
            border-radius: 50%;
            transition: box-shadow 0.2s, width 0.3s, height 0.3s, transform 0.3s;
        }
        .celestial-object:hover { z-index: 102 !important; }
        .celestial-object.selected {
            box-shadow: 0 0 20px 5px var(--gold-glow), 0 0 0 2px var(--gold-accent);
            z-index: 100 !important;
        }
        
        .galaxy { background: radial-gradient(ellipse, #fff 0%, rgba(255,255,255,0.6) 10%, rgba(255,255,255,0) 60%); }
        .star { background: radial-gradient(circle, #fff, var(--gold-accent)); box-shadow: 0 0 40px var(--gold-accent); }
        .planet { background-color: #38bdf8; z-index: 50; }
        .rocket { width: 30px; height: 50px; background-image: url('https://img.icons8.com/plasticine/100/experimental-rocket.png'); background-size: contain; background-repeat: no-repeat; border-radius: 0; }
        .satellite { width: 40px; height: 40px; background-image: url('https://img.icons8.com/plasticine/100/satellite.png'); background-size: contain; background-repeat: no-repeat; border-radius: 0; }
        
        .orbit-path {
            position: absolute; border: 1px dashed var(--border-color);
            border-radius: 50%; pointer-events: none;
            transition: all 0.3s;
        }
    </style>
</head>
<body>
    
    <div id="creation-screen">
        <div class="creation-box">
            <h1>Define Your Universe</h1>
            <p>Begin by setting the fundamental properties of your new reality.</p>
            <div class="form-group">
                <label for="universe-name">Universe Name</label>
                <input type="text" id="universe-name" value="My New Universe">
            </div>
            <div class="form-group">
                <label for="universe-color">Ambient Background Color</label>
                <input type="color" id="universe-color" value="#0a0e15">
            </div>
            <div class="form-group">
                <label for="universe-area">Universe Area</label>
                <select id="universe-area">
                    <option value="1">Small (2000x2000)</option>
                    <option value="2" selected>Medium (4000x4000)</option>
                    <option value="3">Large (8000x8000)</option>
                </select>
            </div>
            <button id="create-universe-btn">Create Universe</button>
        </div>
    </div>

    <div id="sandbox-screen">
        <aside class="toolbox">
            <div>
                <h2 id="universe-title">Universe</h2>
                <h3>Add Celestial Objects</h3>
                <div class="tool-item" data-type="galaxy"><div class="tool-item-icon">üåå</div><h3>Galaxy</h3></div>
                <div class="tool-item" data-type="star"><div class="tool-item-icon">üåü</div><h3>Star</h3></div>
                <div class="tool-item" data-type="planet"><div class="tool-item-icon">ü™ê</div><h3>Planet</h3></div>
                
                <h3 style="margin-top: 2rem;">Constructs</h3>
                <div class="tool-item" onclick="location.href='/create-rocket.html'"><div class="tool-item-icon">üöÄ</div><h3>Create Rocket</h3></div>
                <div class="tool-item" onclick="location.href='/create-satellite.html'"><div class="tool-item-icon">üõ∞Ô∏è</div><h3>Create Satellite</h3></div>
            </div>
            
            <div id="inspector-panel">
                <h3 id="inspector-title">Inspector</h3>
                <div class="inspector-group">
                    <label for="name-input">Object Name</label>
                    <input type="text" id="name-input">
                </div>
                <div id="galaxy-settings" class="inspector-section">
                    <div class="inspector-group"><label for="galaxy-type">Type</label><select id="galaxy-type"><option>Spiral</option><option>Elliptical</option><option>Irregular</option></select></div>
                </div>
                <div id="star-settings" class="inspector-section">
                    <div class="inspector-group"><label for="star-type">Type</label><select id="star-type"><option>G-Type (Sun-like)</option><option>Red Giant</option><option>Blue Supergiant</option></select></div>
                </div>
                <div id="planet-settings" class="inspector-section">
                    <div class="inspector-group"><label for="size-input">Planet Size</label><input type="range" id="size-input" min="10" max="80"></div>
                    <div class="inspector-group"><label for="color-input">Planet Color</label><input type="color" id="color-input"></div>
                    <div class="inspector-group"><label for="oxygen-input">Oxygen Level</label><input type="text" id="oxygen-input"></div>
                    <div class="inspector-group"><label for="life-input">Type of Life</label><select id="life-input"><option>None</option><option>Microbial</option><option>Complex</option><option>Intelligent</option></select></div>
                </div>
            </div>
             <button id="save-btn" style="width: 100%; margin-top: 1rem; background-color: var(--gold-accent); color: var(--bg-dark); border: none; padding: 0.75rem; font-weight: bold; border-radius: 6px; cursor: pointer;">Save Universe</button>
        </aside>

        <main class="universe-canvas" id="universe-canvas">
            <div id="canvas-content">
                </div>
        </main>
    </div>

    <script>
        // --- SCREEN MANAGEMENT ---
        const creationScreen = document.getElementById('creation-screen');
        const sandboxScreen = document.getElementById('sandbox-screen');
        const createUniverseBtn = document.getElementById('create-universe-btn');
        const universeTitle = document.getElementById('universe-title');
        const universeCanvas = document.getElementById('universe-canvas');
        const canvasContent = document.getElementById('canvas-content');

        createUniverseBtn.addEventListener('click', () => {
            const name = document.getElementById('universe-name').value;
            const color = document.getElementById('universe-color').value;
            const area = document.getElementById('universe-area').value;
            const size = parseInt(area) * 2000;
            
            universeTitle.textContent = name;
            universeCanvas.style.backgroundColor = color;
            canvasContent.style.width = `${size}px`;
            canvasContent.style.height = `${size}px`;
            
            creationScreen.style.display = 'none';
            sandboxScreen.style.display = 'flex';
        });

        // --- STATE & DATA ---
        let activeObject = null;
        let objectCounter = 0;
        let objects = new Map();
        
        // --- ZOOM & PAN LOGIC ---
        let scale = 1;
        let panning = false;
        let pointX = 0, pointY = 0;
        let start = { x: 0, y: 0 };

        function setTransform() {
            canvasContent.style.transform = `translate(${pointX}px, ${pointY}px) scale(${scale})`;
        }
        
        universeCanvas.onmousedown = (e) => {
            e.preventDefault();
            start = { x: e.clientX - pointX, y: e.clientY - pointY };
            panning = true;
        };
        universeCanvas.onmouseup = () => { panning = false; };
        universeCanvas.onmousemove = (e) => {
            if (!panning) return;
            pointX = e.clientX - start.x;
            pointY = e.clientY - start.y;
            setTransform();
        };
        universeCanvas.onwheel = (e) => {
            e.preventDefault();
            const xs = (e.clientX - pointX) / scale;
            const ys = (e.clientY - pointY) / scale;
            const delta = -e.deltaY;
            (delta > 0) ? (scale *= 1.2) : (scale /= 1.2);
            pointX = e.clientX - xs * scale;
            pointY = e.clientY - ys * scale;
            setTransform();
        };

        // --- OBJECT CREATION & MANAGEMENT ---
        document.querySelectorAll('.tool-item').forEach(item => {
            item.addEventListener('click', () => {
                const type = item.dataset.type;
                if(type) createObject(type, { x: 200, y: 200 });
            });
        });

        function createObject(type, position, customData = {}) {
            objectCounter++;
            const id = `obj-${objectCounter}`;
            const objEl = document.createElement('div');
            objEl.className = `celestial-object ${type}`;
            objEl.id = id;
            objEl.style.left = `${position.x}px`;
            objEl.style.top = `${position.y}px`;
            
            const objectData = {
                id, el: objEl, type,
                name: customData.name || `${type.charAt(0).toUpperCase() + type.slice(1)} ${objectCounter}`,
                ...customData
            };
            
            if (type === 'planet') {
                const orbitEl = document.createElement('div');
                orbitEl.className = 'orbit-path';
                canvasContent.appendChild(orbitEl);
                objectData.orbitEl = orbitEl;
                objectData.orbitalAngle = Math.random() * 360;
                objectData.orbitSpeed = (Math.random() * 0.2) + 0.1;
                objectData.size = objectData.size || 20;
                objEl.style.width = `${objectData.size}px`;
                objEl.style.height = `${objectData.size}px`;
            }
            if (type === 'galaxy' || type === 'star') {
                objEl.style.width = type === 'galaxy' ? '250px' : '60px';
                objEl.style.height = type === 'galaxy' ? '250px' : '60px';
            }

            objects.set(id, objectData);
            
            objEl.addEventListener('click', e => { e.stopPropagation(); selectObject(objectData); });
            canvasContent.appendChild(objEl);
            selectObject(objectData);
            
            if (type === 'planet') updatePlanetOrbit(objectData);
        }

        // --- INSPECTOR LOGIC ---
        const inspectorSections = document.querySelectorAll('.inspector-section');
        function selectObject(objData) {
            if (activeObject?.el) activeObject.el.classList.remove('selected');
            activeObject = objData;
            activeObject.el.classList.add('selected');

            inspectorPanel.style.display = 'block';
            document.getElementById('inspector-title').textContent = objData.type.charAt(0).toUpperCase() + objData.type.slice(1);
            document.getElementById('name-input').value = objData.name;
            
            inspectorSections.forEach(s => s.style.display = 'none');
            const settingsEl = document.getElementById(`${objData.type}-settings`);
            if (settingsEl) settingsEl.style.display = 'block';
        }

        // --- ORBIT SIMULATION ---
        function animate() { /* ... same as before ... */ }
        function updatePlanetOrbit(planetData) { /* ... same as before ... */ }
        
        // --- AUTOMATIC IMPORT FROM BUILDERS (SIMULATED) ---
        window.addEventListener('load', () => {
            const importedRocket = localStorage.getItem('completedRocket');
            const importedSatellite = localStorage.getItem('completedSatellite');

            if (importedRocket) {
                createObject('rocket', { x: 50, y: 50 }, JSON.parse(importedRocket));
                localStorage.removeItem('completedRocket'); // Clear after import
            }
            if (importedSatellite) {
                createObject('satellite', { x: 150, y: 50 }, JSON.parse(importedSatellite));
                localStorage.removeItem('completedSatellite');
            }
        });
        // In create-rocket.html, on "completion", you would run:
        // localStorage.setItem('completedRocket', JSON.stringify({ name: 'Orion I' }));
        // window.location.href = '/your-space.html';

        // --- SAVE TO ACCOUNT ---
        document.getElementById('save-btn').addEventListener('click', async () => {
            const universeData = {
                name: universeTitle.textContent,
                settings: {
                    color: universeCanvas.style.backgroundColor,
                    size: canvasContent.style.width
                },
                objects: Array.from(objects.values()).map(obj => ({
                    id: obj.id,
                    type: obj.type,
                    name: obj.name,
                    position: { x: obj.el.style.left, y: obj.el.style.top },
                    // Add other properties here
                }))
            };
            
            try {
                const response = await fetch('/api/save-universe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(universeData)
                });
                if(response.ok) {
                    alert('Universe saved successfully!');
                } else {
                    alert('Failed to save universe. Are you logged in?');
                }
            } catch (error) {
                console.error('Save error:', error);
                alert('An error occurred while trying to save.');
            }
        });

        // Other functions (getCenter, makeDraggable, inspector listeners, etc.) remain largely the same.
        // For brevity, they are omitted but should be copied from the previous version.
        // Start the animation loop
        animate();
    </script>
</body>
</html>
