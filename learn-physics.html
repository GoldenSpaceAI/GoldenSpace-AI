<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GoldenSpaceAI â€¢ Learn Physics</title>

    <style>
      :root {
        --bg: #0b0f14;
        --panel: #131a25;
        --panel2: #0f1520;
        --border: #1f2a40;
        --gold: #f6c64a;
        --gold2: #eb8b36;
        --text: #e7f4e9;
        --muted: #cfc6a5;
        --shadow: 0 18px 60px rgba(0, 0, 0, 0.45);
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0; color: var(--text);
        font: 15px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
        background:
          radial-gradient(1100px 520px at 85% -10%, rgba(246, 198, 74, 0.12), transparent 60%),
          radial-gradient(900px 480px at -10% 0%, rgba(246, 198, 74, 0.08), transparent 60%),
          #0a0e15;
        min-height: 100svh;
      }
      a { color: inherit; text-decoration: none; }

      /* Top */
      .top { position: sticky; top: 0; z-index: 10; padding: clamp(14px, 2.2vh, 22px) 18px 10px;
        background: linear-gradient(180deg, rgba(10, 14, 21, 0.92), rgba(10, 14, 21, 0.65) 60%, transparent);
        border-bottom: 1px solid var(--border); backdrop-filter: blur(8px);
        display: flex; align-items: center; gap: 12px; }
      .back { display: inline-flex; align-items: center; gap: 8px; padding: 8px 14px; border-radius: 999px; font-weight: 900; font-size: 14px;
        background: linear-gradient(180deg, var(--gold), var(--gold2)); color: #1b1300; border: 1px solid rgba(0, 0, 0, 0.18); box-shadow: 0 10px 26px rgba(246, 198, 74, 0.25);
        transition: transform 0.2s ease, filter 0.2s ease; }
      .back:hover { transform: translateY(-1px); filter: saturate(1.05); }
      .title { font-weight: 900; letter-spacing: 0.4px; color: var(--gold); font-size: clamp(22px, 2.6vw, 28px); text-shadow: 0 0 18px rgba(246, 198, 74, 0.25); }
      .spacer { flex: 1; }

      /* Layout */
      .wrap { max-width: 1200px; margin: 26px auto; padding: 0 18px; display: grid; gap: 18px; grid-template-columns: 1.4fr 0.9fr; }
      @media (max-width: 1100px) { .wrap { grid-template-columns: 1fr; } }

      .panel { background: linear-gradient(180deg, var(--panel), var(--panel2)); border: 1px solid var(--border); border-radius: 16px; padding: 18px; box-shadow: var(--shadow); }
      .panel h2 { margin: 0 0 10px; font-size: 18px; color: var(--gold); font-weight: 900; }
      .sub { margin: 6px 0 14px; color: var(--muted); font-size: 14px; }

      /* Cards grid: 20 topics */
      .topics { display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
      .card { background: #0d1420; border: 1px solid var(--border); border-radius: 14px; padding: 14px; transition: transform 0.12s ease, box-shadow 0.12s ease; cursor: pointer; }
      .card:hover { transform: translateY(-2px); box-shadow: 0 14px 30px rgba(0, 0, 0, 0.25); }
      .card h3 { margin: 0 0 6px; font-size: 16px; display: flex; align-items: center; gap: 8px; }
      .pill { display: inline-block; padding: 3px 8px; border-radius: 999px; font-size: 12px; font-weight: 800; color: #1b1300; background: linear-gradient(180deg, #f8d772, #e7b72f); }
      .tiny { font-size: 12px; color: var(--muted); }
      .formula { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color: #ffe08a; }

      details { margin-top: 8px; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
      summary { cursor: pointer; padding: 10px 12px; background: #0f1725; list-style: none; font-weight: 800; }
      summary::-webkit-details-marker { display: none; }
      details .content { padding: 12px; background: #0b111c; }

      /* Right: Tools + Tutor */
      .box { background: #0d1420; border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
      label { display: block; font-size: 12px; color: var(--muted); margin-top: 6px; }
      input[type="number"], input[type="text"], textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #0b1219; color: var(--text); margin-top: 6px; }
      .btn { margin-top: 10px; border-radius: 12px; padding: 10px 14px; font-weight: 900; cursor: pointer; background: linear-gradient(180deg, var(--gold), var(--gold2)); color: #1b1300; border: 1px solid rgba(0, 0, 0, 0.18); box-shadow: 0 10px 26px rgba(246, 198, 74, 0.28); transition: transform 0.2s ease, filter 0.2s ease; }
      .btn:hover { transform: translateY(-1px); filter: saturate(1.05); }
      .out { margin-top: 8px; font-weight: 900; color: var(--gold); }

      .ai-wrap { margin-top: 14px; }
      .ai { display: flex; gap: 10px; }
      .ai input { flex: 1; }

      /* Tutor chat */
      .tutor { margin-top: 14px; }
      .chat { height: 280px; overflow: auto; display: flex; flex-direction: column; gap: 10px; padding: 10px; background: #0b1219; border: 1px solid var(--border); border-radius: 12px; }
      .bubble { padding: 10px 12px; border-radius: 12px; border: 1px solid #22304a; background: #0e1622; }
      .me { align-self: flex-end; background: #121b29; border-color: #3a2a00; }
      .assistant { align-self: flex-start; }
      .controls { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: start; margin-top: 10px; }
      .row { display: flex; gap: 8px; margin-top: 6px; }
      .tag { font-size: 11px; border: 1px solid var(--border); padding: 4px 8px; border-radius: 999px; color: var(--muted); cursor: pointer; }
      .tag:hover { color: var(--gold); border-color: #3b2a00; }
    </style>
  </head>
  <body>
    <div class="top">
      <a class="back" href="/">Home</a>
      <div class="title">Learn Physics</div>
      <div class="spacer"></div>
    </div>

    <main class="wrap">
      <!-- LEFT: the 20 topic cards -->
      <section class="panel">
        <h2>Core Topics</h2>
        <p class="sub">Premium notes with worked examples. Tap to expand.</p>

        <div id="topics" class="topics">
          <!-- Cards injected below -->
        </div>
      </section>

      <!-- RIGHT: Tools + GPTâ€‘4 Tutor (server key) -->
      <aside class="panel">
        <h2>Tools</h2>

        <div class="box">
          <h3 style="margin: 0 0 6px">Kinematics (quick)</h3>
          <label>u (m/s)</label><input id="u" type="number" step="any" />
          <label>a (m/sÂ²)</label><input id="a" type="number" step="any" />
          <label>t (s)</label><input id="t" type="number" step="any" />
          <button class="btn" id="kinBtn">Compute</button>
          <div id="calcOut" class="out"></div>
        </div>

        <!-- GPTâ€‘4 Physics Helper (server-side key on Render) -->
        <div class="panel ai-wrap">
          <h2>Quick Explain (GPTâ€‘4)</h2>
          <p class="tiny">Ask a concept or calculation. Uses your server API key on Render (no keys in the browser).</p>
          <div class="ai">
            <input id="aiQ" type="text" placeholder="e.g., Why doesnâ€™t escape velocity depend on mass?" />
            <button id="aiBtn" class="btn">Ask</button>
          </div>
          <div id="aiOut" class="out"></div>
        </div>

        <!-- Full Tutor -->
        <div class="panel tutor">
          <h2>Physics Tutor (GPTâ€‘4)</h2>
          <div class="tiny">Pick a topic from the left, then ask. Modes: Socratic â€¢ Steps â€¢ Practice â€¢ Check</div>
          <div id="chat" class="chat"></div>
          <div class="controls">
            <textarea id="ask" rows="2" placeholder="Ask a physics questionâ€¦"></textarea>
            <button id="send" class="btn">Ask Tutor â†’</button>
          </div>
          <div class="row">
            <div class="tag" data-mode="Socratic">ðŸ’¡ Socratic</div>
            <div class="tag" data-mode="Steps">ðŸªœ Steps</div>
            <div class="tag" data-mode="Practice">ðŸ§ª Practice</div>
            <div class="tag" data-mode="Check">âœ… Check</div>
          </div>
        </div>
      </aside>
    </main>

    <script>
      // ----------------- Topic Cards (20) -----------------
      const TOPIC_DATA = [
        {t:'Mechanics', pill:'Kinematics & Dynamics', formulas:['v = u + at','s = ut + Â½atÂ²','vÂ² = uÂ² + 2as','F = ma','P = W/t']},
        {t:'Rotational Dynamics', pill:'Torque', formulas:['Ï„ = IÎ±','L = IÏ‰','K_rot = Â½IÏ‰Â²','v = Ï‰r']},
        {t:'SHM & Oscillations', pill:'Periodic', formulas:['x = A cos(Ï‰t+Ï†)','Ï‰ = âˆš(k/m)','T = 2Ï€/Ï‰','T_pend = 2Ï€âˆš(L/g)']},
        {t:'Gravitation & Orbits', pill:'Kepler', formulas:['F = GmM/rÂ²','U = -GmM/r','v_orb = âˆš(GM/r)','v_esc = âˆš(2GM/r)']},
        {t:'Energy & Momentum', pill:'Conservation', formulas:['K = Â½mvÂ²','W = Î”K','p = mv']},
        {t:'Fluid Mechanics', pill:'Pressure', formulas:['P = Pâ‚€ + Ïgh','F_b = ÏgV','Aâ‚vâ‚ = Aâ‚‚vâ‚‚','Bernoulli']},
        {t:'Waves & Optics', pill:'Interference', formulas:['v = fÎ»','I âˆ AÂ²','Î”y = Î»L/d','1/f = 1/u + 1/v']},
        {t:'Thermodynamics', pill:'Laws', formulas:['Î”U = Q - W','PV = nRT','Î· = 1 - Tc/Th']},
        {t:'Thermal Physics', pill:'Heat Transfer', formulas:['Q/t = kAÎ”T/L','P = ÏƒÎµATâ´']},
        {t:'Electricity', pill:'DC Circuits', formulas:['V = IR','P = VI = IÂ²R = VÂ²/R','Req series/parallel']},
        {t:'Magnetism', pill:'Fields & Induction', formulas:['F = qvB sinÎ¸','F = BIL sinÎ¸','Îµ = -dÎ¦/dt']},
        {t:'Electromagnetism', pill:'Maxwell', formulas:['âˆ‡Â·E=Ï/Îµâ‚€','âˆ‡Â·B=0','âˆ‡Ã—E=-âˆ‚B/âˆ‚t','âˆ‡Ã—B=Î¼â‚€J+Î¼â‚€Îµâ‚€âˆ‚E/âˆ‚t','c=1/âˆš(Î¼â‚€Îµâ‚€)']},
        {t:'Modern Physics', pill:'Photoelectric', formulas:['E = hf = hc/Î»','Kmax = hf - Î¦']},
        {t:'Relativity', pill:'SR/GR', formulas:['Î³ = 1/âˆš(1 - vÂ²/cÂ²)','Î”t\' = Î³Î”t','L\' = L/Î³','E = Î³mcÂ²']},
        {t:'Quantum Mechanics', pill:'Basics', formulas:['Î» = h/p','Î”xÎ”p â‰¥ Ä§/2']},
        {t:'Nuclear Physics', pill:'Decay', formulas:['N = Nâ‚€ e^{-Î»t}','TÂ½ = ln2/Î»','E = Î”mcÂ²']},
        {t:'Materials & Solid State', pill:'Stressâ€“Strain', formulas:['Ïƒ = F/A','Îµ = Î”L/L','E = Ïƒ/Îµ']},
        {t:'Units & Error Analysis', pill:'Significant', formulas:['Î”z = âˆš(Î”xÂ²+Î”yÂ²)','relative errors add']},
        {t:'Astronomy & Astrophysics', pill:'Cosmic', formulas:['L = 4Ï€RÂ²ÏƒTâ´','v = Hâ‚€ d']},
        {t:'Rocketry & Spaceflight', pill:'Tsiolkovsky', formulas:['Î”v = v_e ln(m0/mf)','v_e = g0 Isp']},
      ];

      const topicsWrap = document.getElementById('topics');
      let CURRENT_TOPIC = TOPIC_DATA[0].t;

      TOPIC_DATA.forEach((d)=>{
        const el = document.createElement('div');
        el.className = 'card';
        el.innerHTML = `
          <h3>${d.t} <span class="pill">${d.pill}</span></h3>
          <div class="tiny">Tap to expand. Current topic set when clicked.</div>
          <details><summary>Key formulas</summary>
            <div class="content">${d.formulas.map(f=>`<div class='formula'>${f}</div>`).join('')}</div>
          </details>`;
        el.addEventListener('click', ()=>{ CURRENT_TOPIC = d.t; toast(`Topic set: ${d.t}`); });
        topicsWrap.appendChild(el);
      });

      // ----------------- Small tools -----------------
      document.getElementById('kinBtn').onclick = ()=>{
        const u=+document.getElementById('u').value||0;
        const a=+document.getElementById('a').value||0;
        const t=+document.getElementById('t').value||0;
        const v=u+a*t; const s=u*t+0.5*a*t*t;
        document.getElementById('calcOut').innerText = `v=${v.toFixed(2)} m/s, s=${s.toFixed(2)} m`;
      };

      // ----------------- Quick Explain (server) -----------------
      const aiInput = document.getElementById('aiQ');
      const aiBtn   = document.getElementById('aiBtn');
      const aiOut   = document.getElementById('aiOut');
      async function askExplain(){
        const question = (aiInput.value||'').trim(); if(!question) return;
        aiBtn.disabled = true; aiOut.textContent = 'Thinkingâ€¦ âœ¨';
        try{
          const res = await fetch('/api/physics-explain', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ question }) });
          const data = await res.json();
          aiOut.innerHTML = (data.reply||'No reply.').replace(/
/g,'<br>');
        }catch(e){ aiOut.textContent = 'Error: '+(e.message||'Something went wrong.'); }
        finally{ aiBtn.disabled = false; }
      }
      aiBtn.addEventListener('click', askExplain);
      aiInput.addEventListener('keydown', e=>{ if(e.key==='Enter') askExplain(); });

      // ----------------- Tutor Chat (server, GPTâ€‘4) -----------------
      const chat = document.getElementById('chat');
      const ask  = document.getElementById('ask');
      const send = document.getElementById('send');
      const modeTags = Array.from(document.querySelectorAll('.tag'));
      let MODE = 'Socratic';
      modeTags.forEach(t=>t.addEventListener('click', ()=>{ MODE = t.dataset.mode; toast(`Mode: ${MODE}`);}));

      function bubble(role, html){
        const b = document.createElement('div');
        b.className = `bubble ${role==='user'?'me':'assistant'}`; b.innerHTML = html; chat.appendChild(b); chat.scrollTop = chat.scrollHeight; return b;
      }

      async function sendTutor(text){
        const thinking = bubble('assistant', 'Thinkingâ€¦');
        try{
          const res = await fetch('/api/physics-tutor', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ question: text, topic: CURRENT_TOPIC, mode: MODE }) });
          const data = await res.json();
          thinking.innerHTML = (data.reply||'No reply.').replace(/
/g,'<br>');
        }catch(e){ thinking.innerHTML = `<span style='color:#ff9a9a'>${(e.message||'Error')}</span>`; }
      }

      send.addEventListener('click', ()=>{ const v=(ask.value||'').trim(); if(!v) return; bubble('user', v.replace(/
/g,'<br>')); ask.value=''; sendTutor(v); });
      ask.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send.click(); } });

      // ----------------- Tiny Toast -----------------
      function toast(msg){
        const el = document.createElement('div');
        el.textContent = msg; el.style.position='fixed'; el.style.bottom='18px'; el.style.left='50%'; el.style.transform='translateX(-50%)';
        el.style.padding='8px 12px'; el.style.border='1px solid var(--border)'; el.style.background='#0d1420'; el.style.borderRadius='999px'; el.style.boxShadow='var(--shadow)'; el.style.zIndex='50';
        document.body.appendChild(el); setTimeout(()=>{ el.remove(); }, 1400);
      }
    </script>
  </body>
</html>
