<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GoldenSpaceAI â€” Advanced AI</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0a07; --ink:#fff6d8; --gold:#ffd24f; --gold-2:#ffb703; --line:rgba(255,210,79,.22);
    }
    body{
      background:radial-gradient(1200px 800px at 80% -10%, #38300f 0%, #19160a 55%, #0a0a07 100%);
      color:var(--ink); font-family:ui-sans-serif,system-ui,Inter,"Segoe UI",Arial;
      margin:0;min-height:100vh;display:flex;flex-direction:column;
    }
    .chat{flex:1;max-width:960px;width:100%;margin:0 auto;padding:20px;display:flex;flex-direction:column}
    .feed{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
    .msg{max-width:80ch;white-space:pre-wrap;padding:10px 14px;border-radius:12px}
    .msg.ai{background:rgba(255,210,79,.07);border:1px solid var(--line)}
    .msg.you{background:rgba(255,183,3,.08);border:1px solid rgba(255,183,3,.3)}
    .thinking{opacity:.8;font-style:italic}
    .row{display:grid;grid-template-columns:1fr auto;gap:10px}
    input{
      background:transparent;border:1px solid var(--line);color:var(--ink);
      border-radius:12px;padding:12px;outline:none;
    }
    .btn{
      border:1px solid var(--line);background:rgba(255,210,79,.12);color:var(--ink);
      padding:12px 16px;border-radius:12px;font-weight:600;cursor:pointer;
    }
    /* mic+cam toggle */
    .vc-toggle{
      position:fixed;right:16px;bottom:72px;width:50px;height:50px;
      border-radius:50%;display:grid;place-items:center;
      background:linear-gradient(180deg,var(--gold),var(--gold-2));
      color:#1a1200;font-weight:900;border:1px solid rgba(0,0,0,.35);
      cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.45);
    }
    .vc-toggle.off{filter:grayscale(.6) brightness(.8)}
    .preview{position:fixed;right:16px;bottom:132px;width:140px;height:80px;
      border-radius:10px;overflow:hidden;border:1px solid var(--line);display:none}
    footer{padding:10px 16px;border-top:1px dashed var(--line);text-align:center;font-size:.9rem}
  </style>
</head>
<body>
  <div class="chat">
    <div id="feed" class="feed"></div>
    <div class="row mt-2">
      <input id="input" placeholder="Type your messageâ€¦"/>
      <button id="sendBtn" class="btn">Send</button>
    </div>
  </div>

  <!-- camera preview -->
  <div id="preview" class="preview">
    <video id="cam" autoplay playsinline muted style="width:100%;height:100%;object-fit:cover"></video>
  </div>

  <!-- mic+cam toggle -->
  <button id="vcBtn" class="vc-toggle off" title="Toggle mic+camera & spoken replies">ðŸŽ¤</button>

  <!-- bottom hint text (only here) -->
  <footer>
    Voice reply is <span id="state">OFF</span>. Turn the gold circle ON to let me speak and show camera preview.
  </footer>

  <script>
    const $=s=>document.querySelector(s);
    const feed=$('#feed'), input=$('#input'), sendBtn=$('#sendBtn');
    const vcBtn=$('#vcBtn'), stateEl=$('#state'), preview=$('#preview'), camEl=$('#cam');
    let voiceMode=false, micStream=null, camStream=null;

    const addMsg=(who,text,extra='')=>{
      const el=document.createElement('div');
      el.className='msg '+(who==='you'?'you':'ai')+' '+extra;
      el.textContent=text; feed.appendChild(el); el.scrollIntoView({behavior:'smooth'});
      return el;
    };

    function speak(text){
      if(!voiceMode) return;
      try{ speechSynthesis.cancel();
        const u=new SpeechSynthesisUtterance(text);
        const v=speechSynthesis.getVoices().find(v=>/en/i.test(v.lang));
        if(v) u.voice=v; speechSynthesis.speak(u);
      }catch{}
    }

    async function ask(q){
      const me=addMsg('you',q);
      const think=addMsg('ai','Thinkingâ€¦','thinking');
      try{
        const res=await fetch('/ask',{method:'POST',
          headers:{'Content-Type':'application/json'},credentials:'include',
          body:JSON.stringify({question:q})});
        const data=await res.json();
        think.remove();
        addMsg('ai',data.answer||'No response.');
        speak(data.answer||'');
      }catch(e){ think.remove(); addMsg('ai','Error contacting AI.'); }
    }

    sendBtn.onclick=()=>{const q=input.value.trim(); if(q){input.value=''; ask(q);} };
    input.addEventListener('keydown',e=>{if(e.key==='Enter'){const q=input.value.trim(); if(q){input.value=''; ask(q);} }});

    vcBtn.onclick=async()=>{
      if(!voiceMode){
        try{micStream=await navigator.mediaDevices.getUserMedia({audio:true});}catch{}
        try{camStream=await navigator.mediaDevices.getUserMedia({video:true});
          camEl.srcObject=camStream; preview.style.display='block';}catch{}
        voiceMode=true; vcBtn.classList.remove('off'); stateEl.textContent='ON';
      }else{
        if(micStream){micStream.getTracks().forEach(t=>t.stop());micStream=null;}
        if(camStream){camStream.getTracks().forEach(t=>t.stop());camStream=null;}
        camEl.srcObject=null; preview.style.display='none';
        voiceMode=false; vcBtn.classList.add('off'); stateEl.textContent='OFF';
      }
    };
  </script>
</body>
</html>
