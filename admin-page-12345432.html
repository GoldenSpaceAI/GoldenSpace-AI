<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - GoldenSpaceAI</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #0f1419; color: #ffffff; min-height: 100vh; }
        .admin-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .lock-screen { background: linear-gradient(135deg, #1a1f2e, #0f1419); min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .lock-box { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 50px; text-align: center; max-width: 500px; width: 90%; }
        .lock-icon { font-size: 4em; margin-bottom: 20px; color: #d4af37; }
        .lock-title { font-size: 2em; margin-bottom: 30px; color: #d4af37; font-weight: 700; }
        .lock-input-group { margin-bottom: 20px; text-align: left; }
        .lock-label { display: block; margin-bottom: 8px; color: #cccccc; font-weight: 600; }
        .lock-input { width: 100%; padding: 15px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); border-radius: 10px; color: white; font-size: 1.1em; font-family: 'Courier New', monospace; }
        .lock-input:focus { outline: none; border-color: #d4af37; }
        .unlock-btn { background: linear-gradient(135deg, #d4af37, #f7ef8a); color: #0f1419; border: none; padding: 18px 40px; border-radius: 15px; font-size: 1.2em; font-weight: 700; cursor: pointer; margin-top: 20px; width: 100%; transition: all 0.3s ease; }
        .unlock-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(212, 175, 55, 0.4); }
        
        .admin-panel { display: none; }
        .admin-header { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border-radius: 20px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1); }
        .admin-title { font-size: 2.5em; color: #d4af37; margin-bottom: 10px; text-align: center; }
        .admin-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .stat-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .stat-number { font-size: 2em; font-weight: 700; color: #d4af37; margin-bottom: 5px; }
        .stat-label { color: #cccccc; font-size: 0.9em; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 30px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .tab { padding: 15px 30px; background: transparent; border: none; color: #cccccc; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; font-weight: 600; }
        .tab.active { background: #d4af37; color: #0f1419; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .requests-grid { display: grid; gap: 20px; }
        .request-card { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; }
        .request-card:hover { border-color: #d4af37; transform: translateY(-2px); }
        .request-header { display: flex; justify-content: between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .user-info { flex: 1; min-width: 250px; }
        .user-email { font-weight: bold; font-size: 1.3em; color: #d4af37; margin-bottom: 5px; }
        .user-provider { color: #888; font-size: 0.9em; }
        .request-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .detail-item { padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); }
        .detail-label { font-size: 0.85em; color: #888; margin-bottom: 5px; }
        .detail-value { font-weight: bold; color: #ffffff; }
        .wallet-address { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 15px 0; font-family: 'Courier New', monospace; word-break: break-all; border: 1px solid rgba(255,255,255,0.1); }
        .action-buttons { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; flex: 1; min-width: 120px; }
        .btn-approve { background: #27ae60; color: white; }
        .btn-deny { background: #e74c3c; color: white; }
        .btn-approve:hover, .btn-deny:hover { transform: translateY(-1px); }
        .btn-approve:hover { background: #219a52; }
        .btn-deny:hover { background: #c0392b; }
        .status-badge { padding: 8px 16px; border-radius: 20px; font-size: 0.85em; font-weight: bold; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d1ecf1; color: #0c5460; }
        .status-denied { background: #f8d7da; color: #721c24; }
        
        .adjustment-form { background: rgba(255,255,255,0.05); padding: 30px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; color: #cccccc; font-weight: 600; }
        .form-input { width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-size: 1em; }
        .form-input:focus { outline: none; border-color: #d4af37; }
        .btn-adjust { background: #d4af37; color: #0f1419; padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; }
        .btn-adjust:hover { background: #f7ef8a; transform: translateY(-1px); }
        
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 10px; color: white; font-weight: 600; z-index: 1000; transform: translateX(400px); transition: transform 0.4s ease; }
        .notification.show { transform: translateX(0); }
        .notification.success { background: #27ae60; }
        .notification.error { background: #e74c3c; }
    </style>
</head>
<body>
    <div class="lock-screen" id="lockScreen">
        <div class="lock-box">
            <div class="lock-icon">üîí</div>
            <h1 class="lock-title">Admin Panel Locked</h1>
            <div class="lock-input-group">
                <label class="lock-label">Lock 1 Key</label>
                <input type="password" class="lock-input" id="lock1" placeholder="Enter lock key 1">
            </div>
            <div class="lock-input-group">
                <label class="lock-label">Lock 2 Key</label>
                <input type="password" class="lock-input" id="lock2" placeholder="Enter lock key 2">
            </div>
            <div class="lock-input-group">
                <label class="lock-label">Lock 3 Key</label>
                <input type="password" class="lock-input" id="lock3" placeholder="Enter lock key 3">
            </div>
            <button class="unlock-btn" id="unlockBtn">üîì Unlock Admin Panel</button>
        </div>
    </div>

    <div class="admin-panel" id="adminPanel">
        <div class="admin-container">
            <div class="admin-header">
                <h1 class="admin-title">GoldenSpaceAI Admin Panel</h1>
                <div class="admin-stats">
                    <div class="stat-card"><div class="stat-number" id="totalRequests">0</div><div class="stat-label">Total Requests</div></div>
                    <div class="stat-card"><div class="stat-number" id="pendingRequests">0</div><div class="stat-label">Pending</div></div>
                    <div class="stat-card"><div class="stat-number" id="approvedRequests">0</div><div class="stat-label">Approved</div></div>
                    <div class="stat-card"><div class="stat-number" id="deniedRequests">0</div><div class="stat-label">Denied</div></div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="payment-requests">üí∞ Payment Requests</button>
                <button class="tab" data-tab="manual-adjust">üîß Manual Adjustment</button>
            </div>

            <div class="tab-content active" id="payment-requests">
                <div class="requests-grid" id="requestsGrid"></div>
            </div>

            <div class="tab-content" id="manual-adjust">
                <div class="adjustment-form">
                    <h3 style="margin-bottom: 20px; color: #d4af37;">Manual Golden Adjustment</h3>
                    <div class="form-group">
                        <label class="form-label">User Email</label>
                        <input type="email" class="form-input" id="adjustEmail" placeholder="Enter user email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount (+ to add, - to subtract)</label>
                        <input type="number" class="form-input" id="adjustAmount" placeholder="e.g., 100 or -50">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Reason</label>
                        <input type="text" class="form-input" id="adjustReason" placeholder="Reason for adjustment">
                    </div>
                    <button class="btn-adjust" id="adjustBtn">Apply Adjustment</button>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        class AdminPanel {
            constructor() {
                this.lockKeys = {};
                this.requests = [];
                this.initializeElements();
                this.loadLockKeys();
                this.setupEventListeners();
            }

            async loadLockKeys() {
                try {
                    const response = await fetch('/api/admin/lock-keys');
                    const data = await response.json();
                    this.lockKeys = data;
                } catch (error) {
                    console.error('Failed to load lock keys:', error);
                    this.showNotification('‚ùå Failed to load lock keys from server', 'error');
                }
            }

            initializeElements() {
                this.elements = {
                    lockScreen: document.getElementById('lockScreen'),
                    adminPanel: document.getElementById('adminPanel'),
                    lock1: document.getElementById('lock1'),
                    lock2: document.getElementById('lock2'),
                    lock3: document.getElementById('lock3'),
                    unlockBtn: document.getElementById('unlockBtn'),
                    requestsGrid: document.getElementById('requestsGrid'),
                    totalRequests: document.getElementById('totalRequests'),
                    pendingRequests: document.getElementById('pendingRequests'),
                    approvedRequests: document.getElementById('approvedRequests'),
                    deniedRequests: document.getElementById('deniedRequests'),
                    adjustEmail: document.getElementById('adjustEmail'),
                    adjustAmount: document.getElementById('adjustAmount'),
                    adjustReason: document.getElementById('adjustReason'),
                    adjustBtn: document.getElementById('adjustBtn'),
                    notification: document.getElementById('notification')
                };
            }

            unlockPanel() {
                const entered1 = this.elements.lock1.value.trim();
                const entered2 = this.elements.lock2.value.trim();
                const entered3 = this.elements.lock3.value.trim();

                if (!this.lockKeys.lock1 || !this.lockKeys.lock2 || !this.lockKeys.lock3) {
                    this.showNotification('‚ùå Lock keys not loaded from server', 'error');
                    return;
                }

                if (entered1 === this.lockKeys.lock1 && 
                    entered2 === this.lockKeys.lock2 && 
                    entered3 === this.lockKeys.lock3) {
                    
                    this.elements.lockScreen.style.display = 'none';
                    this.elements.adminPanel.style.display = 'block';
                    this.loadPaymentRequests();
                    this.startAutoRefresh();
                    
                } else {
                    this.showNotification('‚ùå Invalid lock keys', 'error');
                }
            }

            async loadPaymentRequests() {
                try {
                    const response = await fetch('/api/admin/payment-requests');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.requests = data.requests;
                        this.renderRequests();
                        this.updateStats();
                    }
                } catch (error) {
                    console.error('Failed to load payment requests:', error);
                    this.showNotification('‚ùå Failed to load requests', 'error');
                }
            }

            renderRequests() {
                const grid = this.elements.requestsGrid;
                
                if (this.requests.length === 0) {
                    grid.innerHTML = '<div style="text-align: center; padding: 40px; color: #888;">No payment requests yet</div>';
                    return;
                }
                
                grid.innerHTML = this.requests.map(request => `
                    <div class="request-card">
                        <div class="request-header">
                            <div class="user-info">
                                <div class="user-email">${request.userEmail}</div>
                                <div class="user-provider">via ${request.userProvider} ‚Ä¢ ${request.userName}</div>
                            </div>
                            <div class="status-badge status-${request.status}">
                                ${request.status.toUpperCase()}
                            </div>
                        </div>
                        
                        <div class="request-details">
                            <div class="detail-item">
                                <div class="detail-label">Current Balance</div>
                                <div class="detail-value">${request.currentGoldenBalance}G</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Plan</div>
                                <div class="detail-value">${request.plan}G Pack</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Amount</div>
                                <div class="detail-value">$${request.amount} ${request.crypto}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">To Add</div>
                                <div class="detail-value">+${request.goldenAmount}G</div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="detail-label">User's Sending Wallet</div>
                            <div class="wallet-address">${request.userWalletAddress}</div>
                        </div>
                        
                        <div class="detail-label">Requested</div>
                        <div class="detail-value">${new Date(request.timestamp).toLocaleString()}</div>
                        
                        ${request.status === 'pending' ? `
                        <div class="action-buttons">
                            <button class="btn btn-approve" onclick="adminPanel.approveRequest('${request.id}')">
                                ‚úÖ Approve & Add ${request.goldenAmount}G
                            </button>
                            <button class="btn btn-deny" onclick="adminPanel.denyRequest('${request.id}')">
                                ‚ùå Deny Request
                            </button>
                        </div>
                        ` : ''}
                        
                        ${request.adminNotes ? `
                        <div style="margin-top: 15px;">
                            <div class="detail-label">Admin Notes</div>
                            <div class="detail-value">${request.adminNotes}</div>
                        </div>
                        ` : ''}
                    </div>
                `).join('');
            }

            updateStats() {
                const total = this.requests.length;
                const pending = this.requests.filter(r => r.status === 'pending').length;
                const approved = this.requests.filter(r => r.status === 'approved').length;
                const denied = this.requests.filter(r => r.status === 'denied').length;
                
                this.elements.totalRequests.textContent = total;
                this.elements.pendingRequests.textContent = pending;
                this.elements.approvedRequests.textContent = approved;
                this.elements.deniedRequests.textContent = denied;
            }

            async approveRequest(requestId) {
                const adminNotes = prompt('Add admin notes (optional):');
                
                try {
                    const response = await fetch('/api/admin/approve-payment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            requestId,
                            adminNotes: adminNotes || ''
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showNotification(`‚úÖ ${result.message}`, 'success');
                        this.loadPaymentRequests();
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    console.error('Approve request error:', error);
                    this.showNotification(`‚ùå ${error.message}`, 'error');
                }
            }

            async denyRequest(requestId) {
                const adminNotes = prompt('Reason for denial:');
                if (adminNotes === null) return;
                
                try {
                    const response = await fetch('/api/admin/deny-payment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            requestId,
                            adminNotes: adminNotes || 'No reason provided'
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showNotification('‚ùå Payment request denied', 'success');
                        this.loadPaymentRequests();
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    console.error('Deny request error:', error);
                    this.showNotification(`‚ùå ${error.message}`, 'error');
                }
            }

            async applyAdjustment() {
                const email = this.elements.adjustEmail.value.trim();
                const amount = parseInt(this.elements.adjustAmount.value);
                const reason = this.elements.adjustReason.value.trim();
                
                if (!email || !amount || !reason) {
                    this.showNotification('‚ùå Please fill all fields', 'error');
                    return;
                }
                
                try {
                    const response = await fetch('/api/admin/adjust-golden', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            userEmail: email,
                            amount: amount,
                            reason: reason
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showNotification(`‚úÖ ${result.message} - New balance: ${result.newBalance}G`, 'success');
                        this.elements.adjustEmail.value = '';
                        this.elements.adjustAmount.value = '';
                        this.elements.adjustReason.value = '';
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    console.error('Adjustment error:', error);
                    this.showNotification(`‚ùå ${error.message}`, 'error');
                }
            }

            startAutoRefresh() {
                setInterval(() => {
                    this.loadPaymentRequests();
                }, 10000);
            }

            showNotification(message, type) {
                const notification = this.elements.notification;
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }

            setupEventListeners() {
                this.elements.unlockBtn.addEventListener('click', () => this.unlockPanel());
                
                this.elements.lock1.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.elements.lock2.focus();
                });
                
                this.elements.lock2.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.elements.lock3.focus();
                });
                
                this.elements.lock3.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.unlockPanel();
                });
                
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        tab.classList.add('active');
                        document.getElementById(tab.dataset.tab).classList.add('active');
                    });
                });
                
                this.elements.adjustBtn.addEventListener('click', () => this.applyAdjustment());
            }
        }

        let adminPanel;
        document.addEventListener('DOMContentLoaded', () => {
            adminPanel = new AdminPanel();
        });
    </script>
</body>
</html>
