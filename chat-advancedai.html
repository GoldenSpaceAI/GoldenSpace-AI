<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced AI | GoldenSpaceAI</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* ======================= ROOT COLORS ======================= */
:root {
    --gold: #FFD700;
    --gold-light: #FFF48A;
    --bg-dark: #0A0F1C;
    --bg-card: #111827;
    --border: #2C3548;
    --text: #E5E7EB;
    --text-dim: #9CA3AF;
}

/* ======================= BASE ======================= */
body {
    margin: 0;
    padding: 0;
    background: var(--bg-dark);
    color: var(--text);
    font-family: Inter, Arial, sans-serif;
    height: 100vh;
    display: flex;
    overflow: hidden;
}

/* Hide scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

/* ======================= SUBSCRIPTION SCREEN ======================= */
#subscriptionScreen {
    position: fixed;
    inset: 0;
    background: var(--bg-dark);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

.sub-box {
    background: var(--bg-card);
    border: 2px solid var(--gold);
    width: 92%;
    max-width: 450px;
    padding: 30px;
    border-radius: 20px;
    text-align: center;
}

.sub-box h2 { color: var(--gold); }

.sub-features li {
    text-align: left;
    margin: 10px 0;
    color: var(--text-dim);
}

.sub-btn {
    background: var(--gold);
    border: none;
    padding: 14px 20px;
    font-weight: bold;
    color: #111;
    border-radius: 12px;
    width: 100%;
    cursor: pointer;
    margin-top: 20px;
}

/* ======================= SIDEBAR ======================= */
.sidebar {
    width: 270px;
    background: var(--bg-card);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
}

.sidebar-header {
    padding: 20px;
    border-bottom: 1px solid var(--border);
    font-size: 22px;
    font-weight: bold;
    color: var(--gold);
}

.chat-history {
    flex: 1;
    overflow-y: auto;
}

.chat-item {
    padding: 12px 15px;
    cursor: pointer;
    border-bottom: 1px solid var(--border);
    color: var(--text-dim);
}

.chat-item:hover,
.chat-item.active {
    background: rgba(255, 215, 0, 0.1);
    color: var(--gold);
}

.newChat-btn {
    margin: 15px;
    padding: 10px;
    border-radius: 10px;
    background: none;
    border: 1px solid var(--gold);
    color: var(--gold);
    cursor: pointer;
}

/* MOBILE SIDEBAR CLOSE */
@media (max-width: 900px) {
    .sidebar {
        display: none;
        position: fixed;
        z-index: 1999;
        height: 100%;
        top: 0;
        left: 0;
    }
}

/* ======================= MAIN AREA ======================= */
.main {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100%;
}

/* ===== HEADER ===== */
.header {
    padding: 15px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.model-btn {
    padding: 10px 15px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.05);
    color: var(--text);
    cursor: pointer;
}

.model-btn.active {
    background: var(--gold);
    color: #111;
    border-color: var(--gold);
}

/* ===== CHAT CONTAINER ===== */
.chat-container {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}

.message {
    max-width: 80%;
    margin-bottom: 18px;
    padding: 15px;
    border-radius: 15px;
    line-height: 1.5;
    white-space: pre-wrap;
}

.user {
    margin-left: auto;
    background: var(--gold);
    color: #111;
}

.ai {
    background: var(--bg-card);
    border: 1px solid var(--border);
}

.thinking-dots {
    display: inline-block;
    font-weight: bold;
    animation: blink 1.2s infinite;
}

@keyframes blink {
    0% { opacity: 0.2; }
    50% { opacity: 1; }
    100% { opacity: 0.2; }
}

/* ===== INPUT BAR ===== */
.input-area {
    display: flex;
    padding: 15px;
    border-top: 1px solid var(--border);
    gap: 10px;
}

textarea {
    flex: 1;
    resize: none;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    color: var(--text);
    height: 55px;
}

.send-btn {
    background: var(--gold);
    border: none;
    width: 55px;
    height: 55px;
    border-radius: 50%;
    font-size: 20px;
    cursor: pointer;
    color: #111;
}

/* ===== MOBILE TOP BAR ===== */
.mobile-top {
    display: none;
}

@media (max-width:900px) {
    .mobile-top {
        display: flex;
        padding: 12px;
        background: var(--bg-card);
        border-bottom: 1px solid var(--border);
        align-items: center;
        justify-content: space-between;
    }
    .mobile-menu-btn {
        font-size: 22px;
        color: var(--gold);
        cursor: pointer;
    }
}

</style>
</head>
<body>

<!-- =============== SUBSCRIPTION LOCK =============== -->
<div id="subscriptionScreen">
    <div class="sub-box">
        <h2><i class="fa-solid fa-crown"></i> Unlock Advanced AI</h2>
        <p>Unlock all features for 30 days. Auto-renews 20G monthly.</p>
        <ul class="sub-features">
            <li>• Thinking (GPT-5)</li>
            <li>• Flash (GPT-5 Nano)</li>
            <li>• Pro (GPT-4.1)</li>
            <li>• 20 image generations</li>
            <li>• Unlimited chat</li>
        </ul>
        <button class="sub-btn" id="unlockBtn">Unlock for 20G</button>
    </div>
</div>

<!-- MOBILE TOP BAR -->
<div class="mobile-top">
    <div class="mobile-menu-btn" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
    </div>
    <h3>Advanced AI</h3>
</div>

<!-- =============== SIDEBAR =============== -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">GoldenSpaceAI</div>

    <button class="newChat-btn" onclick="newChat()">+ New Chat</button>

    <div class="chat-history" id="chatHistory"></div>
</div>

<!-- =============== MAIN AREA =============== -->
<div class="main">

    <!-- HEADER -->
    <div class="header">
        <button class="model-btn active" data-model="thinking">Thinking (GPT-5)</button>
        <button class="model-btn" data-model="flash">Flash (GPT-5 Nano)</button>
        <button class="model-btn" data-model="pro">Pro (GPT-4.1)</button>
    </div>

    <!-- CHAT AREA -->
    <div class="chat-container" id="chatContainer">
        <div class="message ai">
            <b>Welcome!</b><br>
            Ask anything — Thinking, Flash, and Pro are ready.
        </div>
    </div>

    <!-- INPUT AREA -->
    <div class="input-area">
        <textarea id="msgInput" placeholder="Type your message..."></textarea>
        <button class="send-btn" onclick="sendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
    </div>

</div>

<script>
/* ======================================================
   SUBSCRIPTION CHECK 
====================================================== */
async function checkSub() {
    const res = await fetch('/api/advanced-ai-status');
    const data = await res.json();

    if (data.active) {
        document.getElementById("subscriptionScreen").style.display = "none";
    } else {
        document.getElementById("subscriptionScreen").style.display = "flex";
    }
}

document.getElementById("unlockBtn").onclick = async () => {
    const res = await fetch('/api/subscribe-advanced-ai', { method: "POST" });
    const data = await res.json();
    if (data.success) location.reload();
};

/* ======================================================
   SIDEBAR MOBILE
====================================================== */
function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    sidebar.style.display = sidebar.style.display === "flex" ? "none" : "flex";
}

/* ======================================================
   MODEL SWITCH
====================================================== */
let currentModel = "thinking";

document.querySelectorAll(".model-btn").forEach(btn=>{
    btn.onclick = ()=>{
        document.querySelectorAll(".model-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        currentModel = btn.dataset.model;
    };
});

/* ======================================================
   CHAT LOGIC
====================================================== */
let chats = JSON.parse(localStorage.getItem("advChats") || "{}");
let currentChat = null;

// Create new chat
function newChat() {
    const id = "chat_" + Date.now();
    chats[id] = { messages: [] };
    currentChat = id;
    saveChats();
    loadChat();
    loadHistory();
}

// Load chat messages
function loadChat() {
    const chat = chats[currentChat];
    const c = document.getElementById("chatContainer");
    c.innerHTML = "";
    chat.messages.forEach(m => renderMessage(m.role, m.text));
}

// Save to localStorage
function saveChats() {
    localStorage.setItem("advChats", JSON.stringify(chats));
}

// Load sidebar chat list
function loadHistory() {
    const h = document.getElementById("chatHistory");
    h.innerHTML = "";
    Object.keys(chats).forEach(id=>{
        const div = document.createElement("div");
        div.className = "chat-item";
        div.innerHTML = chats[id].messages[0]?.text?.slice(0,20) || "New Chat";
        div.onclick = ()=>{ currentChat=id; loadChat(); loadHistory(); };
        if (id === currentChat) div.classList.add("active");
        h.appendChild(div);
    });
}

newChat(); // first load
loadHistory();

/* ======================================================
   RENDER MESSAGE
====================================================== */
function renderMessage(role, text) {
    const msg = document.createElement("div");
    msg.className = "message " + role;
    msg.innerText = text;
    document.getElementById("chatContainer").appendChild(msg);
    msg.scrollIntoView();
}

/* ======================================================
   SEND MESSAGE + STREAM TYPING
====================================================== */
async function sendMessage() {
    const input = document.getElementById("msgInput");
    if (!input.value.trim()) return;
    const userText = input.value.trim();
    input.value = "";

    // Add user message
    chats[currentChat].messages.push({ role:"user", text:userText });
    saveChats();
    renderMessage("user", userText);

    // Thinking placeholder
    const placeholder = document.createElement("div");
    placeholder.className = "message ai";
    placeholder.innerHTML = `Thinking <span class="thinking-dots">...</span>`;
    document.getElementById("chatContainer").appendChild(placeholder);
    placeholder.scrollIntoView();

    // CALL BACKEND
    let endpoint = "/api/generate-thinking";
    if (currentModel === "flash") endpoint = "/api/generate-flash";
    if (currentModel === "pro") endpoint = "/api/generate-pro";

    const res = await fetch(endpoint,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ messages: [{ role:"user", content:userText }] })
    });

    const data = await res.json();

    // Remove placeholder
    placeholder.remove();

    // STREAM LIKE TYPING
    const aiMsg = document.createElement("div");
    aiMsg.className = "message ai";
    document.getElementById("chatContainer").appendChild(aiMsg);

    let i = 0;
    const full = data.text;
    function typeChar() {
        if (i < full.length) {
            aiMsg.innerText += full.charAt(i);
            i++;
            aiMsg.scrollIntoView();
            setTimeout(typeChar, 7);
        }
    }
    typeChar();

    chats[currentChat].messages.push({ role:"ai", text:full });
    saveChats();
}

/* ======================================================
   ON LOAD
====================================================== */
checkSub();

</script>

</body>
</html>
