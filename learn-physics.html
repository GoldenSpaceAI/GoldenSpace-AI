<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GoldenSpaceAI ¬∑ Learn Physics (GPT‚Äë4 Tutor)</title>
  <meta name="description" content="An interactive Physics tutor powered by GPT‚Äë4. Practice problems, hints, and step‚Äëby‚Äëstep explanations with LaTeX rendering."/>
  <style>
    :root{
      --gold-1:#ffd700; --gold-2:#e6c200; --gold-3:#b89700;
      --space-1:#0b0f16; --space-2:#0f1726; --glass:rgba(255,255,255,.06);
      --ring:rgba(255,215,0,.35); --text:#f7f6ef; --muted:#c8b88a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 90% -10%, rgba(255,215,0,.12), transparent 40%),
        radial-gradient(1000px 700px at 0% 120%, rgba(255,215,0,.10), transparent 40%),
        linear-gradient(180deg, var(--space-1), var(--space-2));
    }
    .page{display:grid; grid-template-columns: 300px 1fr; gap:16px; height:100%;}
    aside{
      padding:18px; border-right:1px solid rgba(255,255,255,.06);
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      backdrop-filter: blur(8px);
    }
    main{padding:18px; display:flex; flex-direction:column; height:100%;}

    .brand {display:flex; align-items:center; gap:10px; margin-bottom:14px}
    .logo{width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg,var(--gold-1),var(--gold-3)); box-shadow:0 0 0 2px rgba(0,0,0,.3), 0 0 22px rgba(255,215,0,.25)}
    h1{font-size:18px; margin:0}
    .muted{color:var(--muted); font-size:12px}

    .card{border:1px solid rgba(255,255,255,.08); background:var(--glass); border-radius:16px; box-shadow:0 8px 40px rgba(0,0,0,.35)}
    .panel{padding:12px 14px}

    .section-title{font-size:12px; text-transform:uppercase; letter-spacing:.12em; color:var(--muted); margin:14px 0 8px}

    .topics{display:grid; gap:8px}
    .topic{display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:12px; cursor:pointer; border:1px solid transparent}
    .topic:hover{border-color:var(--ring); background:rgba(255,215,0,.04)}
    .topic.active{border-color:var(--gold-2); background:rgba(255,215,0,.08)}
    .topic input{margin-left:auto}

    .controls {display:grid; gap:10px}
    .row{display:flex; align-items:center; gap:8px}
    .row > *{flex:1}
    label{font-size:12px; color:var(--muted)}
    select, input[type="text"], input[type="password"], textarea{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:var(--text)}

    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); cursor:pointer; user-select:none}
    .btn:hover{border-color:var(--ring); background:rgba(255,215,0,.06)}
    .btn.primary{background:linear-gradient(135deg,var(--gold-2),var(--gold-1)); color:#1a1400; border-color:rgba(0,0,0,.15); box-shadow:0 4px 30px rgba(255,215,0,.25)}
    .btn.ghost{background:transparent}
    .btn.small{padding:8px 10px; font-size:12px}

    /* Chat */
    .chat{display:flex; flex-direction:column; gap:12px; overflow:auto; padding:14px;}
    .bubble{position:relative; padding:12px 14px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03)}
    .bubble.me{align-self:flex-end; border-color:rgba(255,215,0,.25); background:rgba(255,215,0,.06)}
    .bubble.assistant{align-self:flex-start}
    .bubble h4{margin:.2rem 0 .4rem; font-size:13px; color:var(--muted)}
    .bubble .content{font-size:15px; line-height:1.6}
    .msg-toolbar{display:flex; gap:8px; justify-content:flex-end; margin-top:6px}

    .composer{display:grid; grid-template-columns:1fr auto; gap:10px; padding:12px; border-top:1px solid rgba(255,255,255,.06)}
    .actions{display:flex; gap:8px}

    .tags{display:flex; flex-wrap:wrap; gap:6px}
    .tag{font-size:11px; border:1px solid rgba(255,255,255,.15); padding:4px 8px; border-radius:999px; color:var(--muted)}

    .banner{padding:10px 12px; border:1px dashed rgba(255,215,0,.45); border-radius:12px; background:rgba(255,215,0,.06); margin-top:10px}

    code.inline {background:rgba(255,255,255,.08); padding:2px 6px; border-radius:6px}

    @media (max-width: 900px){ .page{grid-template-columns:1fr} aside{order:2} main{order:1} }
  </style>
  <!-- MathJax for LaTeX rendering -->
  <script>
    window.MathJax = { tex: { inlineMath: [['$','$'], ['\\(','\\)']] }, svg: { fontCache: 'global' } };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <div class="page">
    <aside>
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>GoldenSpaceAI</h1>
          <div class="muted">Physics Tutor (GPT‚Äë4)</div>
        </div>
      </div>

      <div class="card panel">
        <div class="section-title">Topics</div>
        <div class="topics" id="topics">
          <!-- Will be injected -->
        </div>
      </div>

      <div class="card panel" style="margin-top:12px">
        <div class="section-title">Tutor Settings</div>
        <div class="controls">
          <div class="row">
            <div>
              <label for="level">Level</label>
              <select id="level">
                <option>Middle School</option>
                <option selected>High School</option>
                <option>AP / IB</option>
                <option>Undergrad</option>
              </select>
            </div>
            <div>
              <label for="mode">Mode</label>
              <select id="mode">
                <option selected>Socratic (ask me guiding questions)</option>
                <option>Direct Explanation</option>
                <option>Exam Drill</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="model">Model</label>
              <select id="model">
                <option value="gpt-4o-mini" selected>gpt-4o-mini (fast)</option>
                <option value="gpt-4o">gpt-4o (balanced)</option>
                <option value="gpt-4-turbo">gpt-4-turbo</option>
              </select>
            </div>
            <div>
              <label for="temperature">Creativity: <span id="tempVal">0.2</span></label>
              <input id="temperature" type="range" min="0" max="1" step="0.1" value="0.2"/>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="apiKey">OpenAI API Key</label>
              <input id="apiKey" type="password" placeholder="sk-..." />
            </div>
            <button class="btn small" id="saveKey">Save</button>
          </div>
          <div class="tags">
            <div class="tag">Latex rendering</div>
            <div class="tag">Hints</div>
            <div class="tag">Step-by-step</div>
            <div class="tag">Practice generator</div>
          </div>
        </div>
      </div>

      <div class="banner" style="margin-top:12px">
        Tip: your key is stored locally in <code class="inline">localStorage</code> on this device.
      </div>
    </aside>

    <main>
      <div class="card" style="flex:1; display:flex; flex-direction:column; overflow:hidden">
        <div class="panel" style="border-bottom:1px solid rgba(255,255,255,.06); display:flex; justify-content:space-between; align-items:center; gap:10px">
          <div>
            <div style="font-weight:600">Physics Tutor</div>
            <div class="muted" id="topicLabel">Pick a topic to focus the tutor.</div>
          </div>
          <div class="actions">
            <button class="btn ghost small" id="btnHint">üí° Hint</button>
            <button class="btn ghost small" id="btnSteps">ü™ú Explain Steps</button>
            <button class="btn ghost small" id="btnPractice">üß™ Generate Practice</button>
            <button class="btn ghost small" id="btnCheck">‚úÖ Check My Work</button>
            <button class="btn small" id="btnClear">üßπ Clear</button>
          </div>
        </div>

        <div id="chat" class="chat"></div>

        <div class="composer">
          <textarea id="input" rows="2" placeholder="Ask a physics question‚Ä¶ (supports LaTeX like F=ma or E=mc^2)"></textarea>
          <div class="actions">
            <button class="btn" id="btnMic" title="Speak">üéôÔ∏è</button>
            <button class="btn primary" id="send">Ask Tutor ‚Üí</button>
          </div>
        </div>
      </div>

      <div class="card panel" style="margin-top:12px">
        <div class="section-title">Quick Starters</div>
        <div class="tags" id="starters"></div>
      </div>
    </main>
  </div>

  <script>
    // ---------- UI Boot ----------
    const TOPICS = [
      {id:'mechanics', name:'Mechanics', examples:['How do I resolve forces on an incline?','Derive range of a projectile','Uniform circular motion period']},
      {id:'waves', name:'Waves & Sound', examples:['What sets the pitch of a closed pipe?','Why does amplitude not affect frequency?']},
      {id:'em', name:'Electricity & Magnetism', examples:['Find the field of a point charge','RC circuit time constant','Right-hand rule refresher']},
      {id:'thermo', name:'Thermodynamics', examples:['Explain entropy with examples','PV diagrams and work']},
      {id:'optics', name:'Optics', examples:['Lens equation 1/f=1/do+1/di','Why do rainbows arc?']},
      {id:'modern', name:'Modern Physics', examples:['Photoelectric effect intuition','de Broglie wavelength of electron']}
    ];

    const topicsEl = document.getElementById('topics');
    const chatEl = document.getElementById('chat');
    const inputEl = document.getElementById('input');
    const topicLabel = document.getElementById('topicLabel');
    const startersEl = document.getElementById('starters');

    TOPICS.forEach((t, idx)=>{
      const el = document.createElement('div');
      el.className = 'topic';
      el.dataset.id = t.id;
      el.innerHTML = `<span>ü™ê</span><div>${t.name}</div><input type="radio" name="topic" ${idx===0? 'checked':''}/>`;
      el.addEventListener('click', ()=>selectTopic(t.id));
      topicsEl.appendChild(el);
    });

    function selectTopic(id){
      document.querySelectorAll('.topic').forEach(n=>{
        n.classList.toggle('active', n.dataset.id===id);
        if(n.dataset.id===id) n.querySelector('input').checked = true;
      });
      const t = TOPICS.find(x=>x.id===id);
      topicLabel.textContent = `Focused on: ${t.name}`;
      renderStarters(t.examples);
    }
    selectTopic('mechanics');

    function renderStarters(list){
      startersEl.innerHTML = '';
      list.forEach(q=>{
        const tag = document.createElement('div');
        tag.className = 'tag'; tag.textContent = q; tag.style.cursor='pointer';
        tag.addEventListener('click', ()=>{ inputEl.value = q; inputEl.focus(); });
        startersEl.appendChild(tag);
      });
    }

    // ---------- Local storage for API key ----------
    const apiKeyInput = document.getElementById('apiKey');
    const saveKeyBtn = document.getElementById('saveKey');
    const saved = localStorage.getItem('openai_api_key');
    if(saved) apiKeyInput.value = saved.replace(/.(?=.{4})/g,'‚Ä¢');
    saveKeyBtn.onclick = ()=>{
      const raw = prompt('Paste your OpenAI API key (sk-...)');
      if(raw){ localStorage.setItem('openai_api_key', raw.trim()); apiKeyInput.value = raw.replace(/.(?=.{4})/g,'‚Ä¢'); alert('Saved locally.'); }
    };

    // ---------- Chat helpers ----------
    const temperatureEl = document.getElementById('temperature');
    const tempValEl = document.getElementById('tempVal');
    temperatureEl.oninput = ()=>{ tempValEl.textContent = temperatureEl.value; };

    function addBubble(role, html){
      const b = document.createElement('div');
      b.className = `bubble ${role==='user'?'me':'assistant'}`;
      b.innerHTML = `<h4>${role==='user'?'You':'Tutor'}</h4><div class="content">${html}</div>`;
      chatEl.appendChild(b);
      chatEl.scrollTop = chatEl.scrollHeight;
      if(window.MathJax) MathJax.typesetPromise([b]);
      return b;
    }

    function escapeHTML(s){ return s.replace(/[&<>]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c])); }

    // ---------- Microphone (basic) ----------
    const micBtn = document.getElementById('btnMic');
    let recognition;
    if('webkitSpeechRecognition' in window){
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'en-US';
      recognition.continuous = false; recognition.interimResults = false;
      recognition.onresult = (e)=>{ inputEl.value = e.results[0][0].transcript; };
      micBtn.onclick = ()=> recognition.start();
    } else {
      micBtn.disabled = true; micBtn.title = 'Speech API not supported';
    }

    // ---------- Model call ----------
    async function callTutor(userText, mode){
      const key = localStorage.getItem('openai_api_key');
      if(!key){ alert('Click Save and add your OpenAI API key first.'); return; }
      const model = document.getElementById('model').value;
      const level = document.getElementById('level').value;
      const topic = document.querySelector('.topic.active div').textContent;
      const temperature = Number(temperatureEl.value);

      const SYSTEM = [
        "You are GoldenSpaceAI, a kind, rigorous Physics tutor.",
        "Always adapt to the student's level: " + level + ".",
        "Prefer step-by-step reasoning with equations in LaTeX.",
        "If asked, use the Socratic method: ask 1‚Äì2 guiding questions before giving full steps.",
        "Provide dimensional analysis and units checks when relevant.",
        "Show a short summary and 1 follow-up practice problem at the end (unless in Exam Drill).",
      ].join(' ');

      const BEHAVIOR = mode || document.getElementById('mode').value;

      const TASK = {
        "Socratic (ask me guiding questions)": `We are working on ${topic}. Start with 1‚Äì2 guiding questions, then outline steps, then final answer.`,
        "Direct Explanation": `Explain clearly for ${level} on ${topic}. Include derivation or diagrams-in-words as needed.`,
        "Exam Drill": `Create 3 exam-style questions on ${topic} at ${level}, then wait for answers. Provide answer key only if asked.`,
        "Hint": `Give a gentle hint for the student's question without revealing the full solution.`,
        "Steps": `Show the full derivation and solution steps from first principles for the student's question.`,
        "Practice": `Generate 3 practice problems (increasing difficulty) on ${topic} with brief solutions hidden after a spoiler line 'Solutions:'`,
        "Check": `Grade the student's work. Identify errors, show corrected steps, and give a score out of 10.`
      }[BEHAVIOR] || '';

      const messages = [
        {role:'system', content: SYSTEM},
        {role:'user', content: `Context topic: ${topic}.\nUser question/work: """${userText}""".\nInstruction: ${TASK}`}
      ];

      const thinkingBubble = addBubble('assistant', 'Thinking‚Ä¶');

      try{
        const res = await fetch('https://api.openai.com/v1/chat/completions',{
          method:'POST',
          headers:{ 'Content-Type':'application/json', 'Authorization': 'Bearer ' + key },
          body: JSON.stringify({
            model,
            temperature,
            messages
          })
        });
        if(!res.ok){
          const t = await res.text();
          throw new Error(`API error ${res.status}: ${t}`);
        }
        const data = await res.json();
        const text = data.choices?.[0]?.message?.content?.trim() || '(No response)';
        thinkingBubble.querySelector('.content').innerHTML = text.replace(/\n/g,'<br/>');
        if(window.MathJax) MathJax.typesetPromise([thinkingBubble]);
      }catch(err){
        thinkingBubble.querySelector('.content').innerHTML = `<span style="color:#ff9a9a">${escapeHTML(err.message)}</span>`;
      }
    }

    // ---------- Buttons ----------
    document.getElementById('send').onclick = ()=>{
      const v = inputEl.value.trim(); if(!v) return;
      addBubble('user', escapeHTML(v));
      callTutor(v);
      inputEl.value = '';
    };
    document.getElementById('btnHint').onclick   = ()=>{ const v = inputEl.value || 'Give me a hint.'; addBubble('user', escapeHTML(v)); callTutor(v,'Hint'); };
    document.getElementById('btnSteps').onclick  = ()=>{ const v = inputEl.value || 'Show me the steps.'; addBubble('user', escapeHTML(v)); callTutor(v,'Steps'); };
    document.getElementById('btnPractice').onclick= ()=>{ const v = inputEl.value || 'Practice on this topic'; addBubble('user', escapeHTML(v)); callTutor(v,'Practice'); };
    document.getElementById('btnCheck').onclick  = ()=>{ const v = inputEl.value || 'Check my solution: ...'; addBubble('user', escapeHTML(v)); callTutor(v,'Check'); };
    document.getElementById('btnClear').onclick  = ()=>{ chatEl.innerHTML=''; };

    // Enter to send
    inputEl.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); document.getElementById('send').click(); }
    });

    // Warm welcome
    addBubble('assistant', `Welcome to <b>Learn Physics</b>! Pick a topic on the left, then ask a question. You can type LaTeX like $F=ma$ and I'll render it.`);
  </script>
</body>
</html>
