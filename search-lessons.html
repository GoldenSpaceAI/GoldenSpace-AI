<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Search Lessons â€¢ GoldenSpaceAI</title>
  <meta name="theme-color" content="#0a0e15" />
  <link rel="icon" href="/favicon.ico" />
  <style>
    :root{
      --nebula:#0a0e1a;
      --glass:#0e1526cc;          /* translucent panel */
      --glass-strong:#0a1120e6;   /* for modals */
      --stroke:rgba(255,255,255,.14);
      --gold:#f6c64a;
      --gold-2:#e49e3d;
      --text:#edf3ff;
      --muted:#cfd8ffcc;
      --chip:#162248cc;
      --chip-stroke:#253365;
      --ok:#7bffb4;
      --err:#ff7b8c;
      --shadow:0 30px 120px rgba(0,0,0,.55);
      --radius:18px;
      --max:1200px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text); font:15px/1.6 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1400px 800px at 20% -10%, rgba(246,198,74,.18), transparent 60%),
        radial-gradient(1200px 700px at 110% 10%, rgba(146,131,255,.18), transparent 55%),
        var(--nebula) fixed;
      /* NASA/Unsplash-style nebula wallpaper */
      background-image:
        linear-gradient(180deg, rgba(7,10,18,.65), rgba(7,10,18,.65)),
        url("https://images.unsplash.com/photo-1451187851023-1f26f08aaac1?q=80&w=2400&auto=format&fit=crop");
      background-size:cover; background-position:center; background-attachment:fixed;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* Top bar */
    .top{
      position:sticky; top:0; z-index:5;
      backdrop-filter:blur(10px);
      background:linear-gradient(180deg, rgba(10,14,25,.78), rgba(10,14,25,.42) 65%, transparent);
      border-bottom:1px solid var(--stroke);
      padding:14px 16px 10px;
    }
    .top-in{max-width:var(--max); margin:0 auto; display:flex; align-items:center; gap:12px}
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.2px;
      color:var(--gold); text-shadow:0 0 16px rgba(246,198,74,.35); font-size:18px;
    }
    .dot{width:10px; height:10px; border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #ffe482, #f6c64a 55%, #e49e3d 90%);
      box-shadow:0 0 14px rgba(246,198,74,.55);
    }
    .spacer{flex:1}
    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px;
      border-radius:999px; border:1px solid var(--stroke);
      background:linear-gradient(180deg, #0d1426aa, #0a1120aa);
      color:var(--muted); font-weight:800; text-decoration:none;
    }
    .cta{
      display:inline-flex; align-items:center; gap:8px; padding:9px 14px; border-radius:12px; font-weight:900;
      background:linear-gradient(180deg, var(--gold), var(--gold-2)); color:#1b1300; border:1px solid rgba(0,0,0,.2);
      box-shadow:0 10px 26px rgba(246,198,74,.28); text-decoration:none;
    }

    /* Layout */
    .wrap{max-width:var(--max); margin:18px auto 120px; padding:0 16px;}
    .layout{
      display:grid; grid-template-columns:320px 1fr; gap:16px;
    }
    @media (max-width:1000px){ .layout{grid-template-columns:1fr} }

    /* Glass panels */
    .panel{
      background:var(--glass); border:1px solid var(--stroke); border-radius:var(--radius);
      box-shadow:var(--shadow);
    }
    .left{padding:14px; display:grid; gap:14px; align-content:start}
    .right{padding:14px}

    .panel h2{margin:0 0 8px; font-size:16px; color:#fff7e0}
    .panel p{margin:0; color:var(--muted)}

    /* Search bar */
    .search{
      display:flex; gap:10px; padding:12px; border-radius:14px; border:1px solid var(--stroke);
      background:linear-gradient(180deg, #0f1730d9, #0a132cd9);
    }
    .search input{
      flex:1; background:transparent; border:0; outline:0; color:var(--text); font-size:16px; padding:8px 2px;
    }
    .btn{
      border:1px solid rgba(0,0,0,.25);
      border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:900;
    }
    .btn.gold{background:linear-gradient(180deg, var(--gold), var(--gold-2)); color:#1b1300; box-shadow:0 10px 26px rgba(246,198,74,.28)}
    .btn.ghost{background:transparent; color:var(--muted); border:1px solid var(--stroke)}

    /* Topic grid */
    .topics{
      display:grid; grid-template-columns:repeat(2, 1fr); gap:8px;
    }
    @media (max-width:560px){ .topics{grid-template-columns:1fr} }
    .topic{
      display:flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px;
      background:var(--chip); border:1px solid var(--chip-stroke); color:#cfe0ff;
      font-weight:700; cursor:pointer; transition:transform .15s ease, border-color .15s ease;
    }
    .topic:hover{ transform:translateY(-1px); border-color:#3a4da1 }
    .sectionTitle{
      margin:8px 2px 6px; color:#ffefc2; font-weight:900; font-size:12px; letter-spacing:.7px; opacity:.9
    }

    /* Results */
    .head{
      display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid var(--stroke); padding:10px 8px;
    }
    .status{ color:var(--muted); font-size:13px }
    .cards{ padding:10px 6px }
    .card{
      background:linear-gradient(180deg, #0f1835cc, #0b132ccc);
      border:1px solid var(--stroke); border-radius:16px; padding:14px; margin:12px 4px;
    }
    .card h3{ margin:0 0 6px; color:#ffeebb; font-size:18px }
    .card p{ margin:0; color:#f3f5ff; white-space:pre-wrap }
    .badge{ display:inline-block; margin-top:8px; font-size:11px; padding:4px 8px; border-radius:999px;
      border:1px solid var(--stroke); color:#ffe9a6; background:#161f3f }

    /* Skeleton */
    .skeleton{ display:grid; gap:10px }
    .sk{
      height:12px; border-radius:8px; background:linear-gradient(90deg, #1a244d, #243774, #1a244d);
      background-size:200% 100%; animation: shimmer 1.1s infinite;
    }
    .w40{width:40%}.w60{width:60%}.w80{width:80%}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    /* ===== 10G FULL-SCREEN LOCK ===== */
    .lock{
      position:fixed; inset:0; z-index:1000;
      background:radial-gradient(1200px 700px at 20% -10%, rgba(246,198,74,.08), transparent 60%),
                 radial-gradient(1200px 800px at 120% 10%, rgba(146,131,255,.10), transparent 55%),
                 rgba(6,10,18,.92);
      display:flex; align-items:center; justify-content:center;
      backdrop-filter: blur(12px);
    }
    .lock-card{
      width:min(720px, 92vw);
      background:var(--glass-strong);
      border:1px solid var(--stroke);
      border-radius:22px; padding:22px 18px; box-shadow:var(--shadow); text-align:center;
    }
    .lock-icon{ font-size:64px; margin:4px 0 6px }
    .lock h1{ margin:2px 0 8px; color:#fff7dc; font-size:24px }
    .desc{ color:var(--muted); margin:8px auto 16px; max-width:560px }
    .price{
      display:inline-flex; align-items:baseline; gap:10px; margin:6px 0 12px;
      padding:12px 16px; border-radius:14px; border:1px solid rgba(246,198,74,.28);
      background:linear-gradient(180deg, rgba(246,198,74,.12), rgba(246,198,74,.05));
    }
    .price .g{ font-size:36px; font-weight:900; color:var(--gold); text-shadow:0 0 12px rgba(246,198,74,.55) }
    .price .per{ font-size:14px; color:#ffeaa6 }
    .balance{ color:#e9f1ff; margin:8px 0 16px }
    .balance .amt{ color:var(--gold); font-weight:900 }
    .lock-actions{ display:grid; gap:10px; width:min(460px, 92%); margin:0 auto }
    .btn-unlock{
      background:linear-gradient(180deg, var(--gold), var(--gold-2)); color:#1b1300; font-weight:900; font-size:16px;
      padding:14px 16px; border-radius:14px; border:1px solid rgba(0,0,0,.2); cursor:pointer;
      box-shadow:0 12px 32px rgba(246,198,74,.35);
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .btn-unlock:hover:not(:disabled){ transform: translateY(-2px); box-shadow:0 18px 40px rgba(246,198,74,.55) }
    .btn-unlock:disabled{ opacity:.7; cursor:not-allowed }
    .btn-buy{
      background:transparent; color:#ffd862; border:1px solid rgba(246,198,74,.35);
      border-radius:12px; padding:12px 14px; font-weight:800; cursor:pointer;
    }
    .note{ font-size:12px; color:#b9c6ff; margin-top:6px }
    .msg{ margin-top:10px; font-weight:700; padding:10px 12px; border-radius:10px; display:none }
    .msg.ok{ display:block; color:var(--ok); background:rgba(123,255,180,.08); border:1px solid rgba(123,255,180,.35) }
    .msg.err{ display:block; color:var(--err); background:rgba(255,123,140,.08); border:1px solid rgba(255,123,140,.35) }
  </style>
</head>
<body>

  <!-- Top bar -->
  <div class="top">
    <div class="top-in">
      <div class="brand"><span class="dot"></span> GoldenSpaceAI</div>
      <div class="spacer"></div>
      <a class="pill" href="/">Home</a>
      <a class="pill" href="/plans.html">Plans</a>
    </div>
  </div>

  <main class="wrap">
    <div class="layout">
      <!-- Left rail (topics) -->
      <aside class="panel left">
        <h2>ðŸ“š Quick Pick Lessons</h2>
        <p>Tap any topic to generate a full lesson.</p>

        <div class="sectionTitle">MATHEMATICS</div>
        <div class="topics">
          <div class="topic">Fractions</div>
          <div class="topic">Decimals</div>
          <div class="topic">Percentages</div>
          <div class="topic">Order of Operations</div>
          <div class="topic">Linear Equations</div>
          <div class="topic">Quadratic Functions</div>
          <div class="topic">Slope & Intercept</div>
          <div class="topic">Pythagorean Theorem</div>
          <div class="topic">Trigonometry Basics</div>
          <div class="topic">Probability</div>
        </div>

        <div class="sectionTitle">SCIENCE</div>
        <div class="topics">
          <div class="topic">Photosynthesis</div>
          <div class="topic">Cell Structure</div>
          <div class="topic">Human Digestive System</div>
          <div class="topic">Newtonâ€™s Laws</div>
          <div class="topic">Electric Circuits</div>
          <div class="topic">States of Matter</div>
          <div class="topic">Atomic Structure</div>
          <div class="topic">Periodic Table</div>
          <div class="topic">Ecosystems</div>
          <div class="topic">The Water Cycle</div>
        </div>

        <div class="sectionTitle">HISTORY & SOCIAL</div>
        <div class="topics">
          <div class="topic">The Roman Empire</div>
          <div class="topic">Ancient Egypt</div>
          <div class="topic">World War II Overview</div>
          <div class="topic">Cold War Basics</div>
          <div class="topic">Industrial Revolution</div>
          <div class="topic">The Silk Road</div>
          <div class="topic">Civil Rights Movement</div>
          <div class="topic">French Revolution</div>
          <div class="topic">American Constitution</div>
          <div class="topic">Geography: Biomes</div>
        </div>

        <div class="sectionTitle">LANGUAGE & STUDY</div>
        <div class="topics">
          <div class="topic">Parts of Speech</div>
          <div class="topic">Subject-Verb Agreement</div>
          <div class="topic">Thesis Statements</div>
          <div class="topic">Essay Structure</div>
          <div class="topic">Note-Taking Methods</div>
          <div class="topic">Citations & Plagiarism</div>
          <div class="topic">Vocabulary Strategies</div>
          <div class="topic">Reading Comprehension</div>
          <div class="topic">Public Speaking Basics</div>
          <div class="topic">Study Schedules</div>
        </div>

        <div class="sectionTitle">TECH & COMPUTING</div>
        <div class="topics">
          <div class="topic">Computer Basics</div>
          <div class="topic">What is an Algorithm?</div>
          <div class="topic">Binary & Data</div>
          <div class="topic">Internet Safety</div>
          <div class="topic">Intro to HTML</div>
          <div class="topic">Intro to CSS</div>
          <div class="topic">Intro to JavaScript</div>
          <div class="topic">What is AI?</div>
          <div class="topic">Intro to Databases</div>
          <div class="topic">Version Control (Git)</div>
        </div>
      </aside>

      <!-- Right content -->
      <section class="panel right" aria-label="Lesson search and results">
        <div class="head">
          <div class="status" id="status">Enter a topic or pick from the left.</div>
          <div class="status" id="count"></div>
        </div>

        <div class="search" style="margin:12px 6px;">
          <input id="q" type="text" placeholder="e.g., â€œPhotosynthesis for 8th gradeâ€, â€œQuadratic Functions with examplesâ€â€¦" autofocus/>
          <button id="go" class="btn gold">Generate Lesson</button>
          <button id="clear" class="btn ghost">Clear</button>
        </div>

        <div class="cards" id="results"></div>
      </section>
    </div>
  </main>

  <!-- ===== 10G FULL-SCREEN LOCK (cannot access page content until unlocked) ===== -->
  <div id="lock" class="lock" aria-modal="true" role="dialog">
    <div class="lock-card">
      <div class="lock-icon">ðŸ”’</div>
      <h1>Educational Lessons â€” Locked</h1>
      <p class="desc">Get unlimited lesson generation with introductions, explanations, worked examples, and practice prompts.</p>
      <div class="price"><span class="g">10G</span> <span class="per">per month</span></div>
      <div class="balance">Your Golden Balance: <span class="amt" id="bal">0G</span></div>

      <div class="lock-actions">
        <button id="unlockBtn" class="btn-unlock">UNLOCK FOR 10G / MONTH</button>
        <a class="btn-buy" href="/buy-golden.html">ðŸ’° Buy More Golden</a>
      </div>
      <div id="msg" class="msg"></div>
      <div class="note">Unlock covers 30 days from purchase. Requires login.</div>
    </div>
  </div>

  <script>
    // ===== Config
    const FEATURE = 'search_lessons';
    const COST = 10;

    // ===== DOM
    const lockEl = document.getElementById('lock');
    const balEl  = document.getElementById('bal');
    const msgEl  = document.getElementById('msg');
    const unlockBtn = document.getElementById('unlockBtn');

    const qEl = document.getElementById('q');
    const goEl = document.getElementById('go');
    const clearEl = document.getElementById('clear');
    const resultsEl = document.getElementById('results');
    const statusEl = document.getElementById('status');
    const countEl = document.getElementById('count');

    // ===== Init
    document.addEventListener('DOMContentLoaded', init);
    function showMsg(text, ok=false){
      msgEl.textContent = text;
      msgEl.className = 'msg ' + (ok ? 'ok' : 'err');
    }

    async function init(){
      try {
        // Check login
        const me = await fetch('/api/me', { credentials:'include' }).then(r=>r.json());
        if (!me.loggedIn) {
          lockEl.style.display = 'flex';
          showMsg('Please log in to unlock.', false);
          await updateBalance();
          return;
        }
        await updateBalance();

        // Check feature status
        const feat = await fetch('/api/feature-status?feature=' + FEATURE, { credentials:'include' }).then(r=>r.json());
        if (feat.unlocked) {
          lockEl.style.display = 'none';
        } else {
          lockEl.style.display = 'flex';
        }
      } catch (e) {
        lockEl.style.display = 'flex';
        showMsg('Could not verify access. Please retry.', false);
      }
    }

    async function updateBalance(){
      try{
        const bal = await fetch('/api/golden-balance', { credentials:'include' }).then(r=>r.json());
        balEl.textContent = (bal.balance ?? 0) + 'G';
      }catch{ /* ignore */ }
    }

    // ===== Unlock flow
    unlockBtn.addEventListener('click', async ()=>{
      unlockBtn.disabled = true;
      showMsg('Processingâ€¦');
      try{
        const res = await fetch('/api/unlock-feature', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          credentials:'include',
          body: JSON.stringify({ feature: FEATURE, cost: COST })
        });
        const data = await res.json();
        if (data.success) {
          await updateBalance();
          showMsg('âœ… Lessons unlocked! Enjoy your 30-day access.', true);
          setTimeout(()=>{ lockEl.style.display = 'none'; }, 800);
        } else {
          showMsg('âŒ ' + (data.error || 'Unlock failed'), false);
          unlockBtn.disabled = false;
        }
      }catch(e){
        showMsg('âŒ Network error. Try again.', false);
        unlockBtn.disabled = false;
      }
    });

    // ===== UX helpers
    clearEl.addEventListener('click', ()=>{
      qEl.value = '';
      resultsEl.innerHTML = '';
      statusEl.textContent = 'Cleared.';
      countEl.textContent = '';
    });

    // Topic clicks (left rail)
    document.addEventListener('click', (e)=>{
      const t = e.target.closest('.topic');
      if (t) {
        qEl.value = t.textContent.trim();
        runSearch();
      }
    });

    goEl.addEventListener('click', runSearch);
    qEl.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') runSearch(); });

    function setLoading(){
      resultsEl.innerHTML = `
        <div class="card"><div class="skeleton">
          <div class="sk w60"></div>
          <div class="sk w80"></div>
          <div class="sk w80"></div>
          <div class="sk w40"></div>
        </div></div>
        <div class="card"><div class="skeleton">
          <div class="sk w60"></div>
          <div class="sk w80"></div>
          <div class="sk w80"></div>
          <div class="sk w40"></div>
        </div></div>`;
      statusEl.textContent = 'Generatingâ€¦';
      countEl.textContent = '';
    }

    function renderLesson(text){
      const parts = text
        .split(/\n{2,}/g)
        .map(s => s.replace(/^\s*[-â€¢]\s*/,'').trim())
        .filter(Boolean)
        .slice(0, 8);

      if (!parts.length) {
        resultsEl.innerHTML = `<div class="card"><p>No content returned.</p></div>`;
        statusEl.textContent = 'No content.';
        countEl.textContent = '';
        return;
      }

      const headings = ['Introduction','Explanation','Examples','Practice','Tips','Common Mistakes','Summary','Next Steps'];
      resultsEl.innerHTML = parts.map((p,i)=>`
        <div class="card">
          <h3>${headings[i] || ('Section ' + (i+1))}</h3>
          <p>${p}</p>
          <span class="badge">Lesson Generated</span>
        </div>
      `).join('');

      statusEl.textContent = 'Completed';
      countEl.textContent = parts.length + ' sections';
    }

    async function runSearch(){
      // If locked, prevent access
      if (lockEl.style.display !== 'none') {
        showMsg('ðŸ”’ Unlock to generate lessons.', false);
        return;
      }
      const topic = (qEl.value || '').trim();
      if (!topic) return;

      goEl.disabled = true;
      setLoading();

      try{
        const res = await fetch('/search-lessons', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({
            query: `Create a clear, student-friendly lesson on: ${topic}.
Structure with: Introduction, Explanation, Worked Examples, and a short Practice section with solutions.
Keep sections concise and readable.`
          })
        });
        if (!res.ok) {
          const t = await res.text().catch(()=> '');
          throw new Error(`Server ${res.status}: ${t.slice(0,120) || 'Unknown error'}`);
        }
        const data = await res.json().catch(()=> ({}));
        const txt = (data.answer ?? data.reply ?? '').toString().trim();
        if (!txt) throw new Error('Empty response');
        renderLesson(txt);
      }catch(err){
        resultsEl.innerHTML = `<div class="card"><p style="color:#ffd3d3">Error: ${escapeHTML(err.message)}</p></div>`;
        statusEl.textContent = 'Failed';
        countEl.textContent = '';
      }finally{
        goEl.disabled = false;
      }
    }

    function escapeHTML(str){ return (str||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]); }
  </script>
</body>
</html>
