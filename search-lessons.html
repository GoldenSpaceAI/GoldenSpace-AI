<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Search Lessons ‚Ä¢ GoldenSpaceAI</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#141a34;
      --panel2:#0f1530;
      --gold1:#f6c64a;
      --gold2:#e7a93e;
      --text:#fdf7e7;
      --muted:#d2c9a8;
      --border:#2a3155;
      --card:#101735;
      --green:#80ffb0;
      --red:#ff7777;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Segoe UI",Roboto,system-ui;
      background:
        radial-gradient(1000px 600px at 80% -10%,rgba(247,201,72,.08),transparent 60%),
        radial-gradient(1000px 600px at -10% 20%,rgba(166,185,255,.08),transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    /* Top Bar */
    .top{
      position:sticky;top:0;z-index:10;
      background:linear-gradient(180deg,rgba(11,16,32,.95),rgba(11,16,32,.7) 70%,transparent);
      backdrop-filter:blur(8px);
      padding:16px 20px;
      display:flex;align-items:center;gap:12px;
    }
    .back{
      background:var(--gold1);color:#2c2100;
      border-radius:999px;border:1px solid rgba(0,0,0,.15);
      padding:8px 14px;font-weight:700;text-decoration:none;
      box-shadow:0 6px 20px rgba(247,201,72,.25);
      transition:.2s;
    }
    .back:hover{background:var(--gold2);transform:translateY(-1px)}
    .title{font-size:24px;font-weight:900;color:var(--gold1);text-shadow:0 0 10px rgba(247,201,72,.4)}
    .spacer{flex:1}

    .wrap{max-width:980px;margin:0 auto;padding:20px 16px 100px}

    /* ========== 10G LOCK ========== */
    .lock-overlay{
      position:fixed;inset:0;z-index:1000;
      background:rgba(11,16,32,0.97);
      display:flex;align-items:center;justify-content:center;
      backdrop-filter:blur(10px);
    }
    .lock-box{
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:2px solid rgba(247,201,72,0.3);
      border-radius:20px;
      padding:34px;
      max-width:500px;width:90%;text-align:center;
      box-shadow:0 30px 100px rgba(0,0,0,.8);
    }
    .lock-box .icon{font-size:60px;margin-bottom:16px}
    .lock-box h2{color:var(--gold1);margin:0 0 10px;font-size:28px}
    .lock-box p{color:var(--muted);line-height:1.6;margin-bottom:20px}
    .lock-box .price{font-size:38px;font-weight:900;color:var(--gold1);text-shadow:0 0 12px rgba(247,201,72,.6)}
    .lock-box .price span{font-size:16px;color:var(--muted)}
    .unlock-btn{
      background:linear-gradient(180deg,var(--gold1),var(--gold2));
      border:none;border-radius:14px;
      color:#2c2100;font-weight:900;font-size:18px;
      padding:16px 32px;margin:20px 0;width:100%;
      cursor:pointer;transition:.25s;
      box-shadow:0 12px 35px rgba(247,201,72,.5);
    }
    .unlock-btn:hover{transform:translateY(-3px);box-shadow:0 18px 45px rgba(247,201,72,.7)}
    .status-message{margin-top:10px;font-size:14px}
    .status-success{color:var(--green)}
    .status-error{color:var(--red)}
    .balance{color:var(--muted);margin:10px 0;font-size:15px}
    .balance span{color:var(--gold1);font-weight:700}
    .buy-more{color:var(--gold1);font-weight:700;text-decoration:none}

    /* Search */
    .searchBox{
      display:flex;gap:8px;
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid var(--border);
      border-radius:16px;padding:10px;
      box-shadow:0 15px 50px rgba(0,0,0,.45);
    }
    input[type=text]{
      flex:1;background:transparent;border:0;outline:0;
      color:var(--text);font-size:16px;padding:10px;
    }
    .btn{
      background:var(--gold1);color:#2c2100;font-weight:800;border:0;border-radius:12px;
      padding:10px 16px;cursor:pointer;
      box-shadow:0 10px 25px rgba(247,201,72,.3);
      transition:.2s;
    }
    .btn:hover{background:var(--gold2);transform:translateY(-1px)}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin:14px 2px 18px}
    .chip{
      background:#161f42;border:1px solid var(--border);color:#a6b9ff;
      border-radius:999px;padding:8px 12px;font-size:13px;cursor:pointer;
      transition:.2s;
    }
    .chip:hover{background:#1e2953;transform:translateY(-1px)}

    /* Lesson Cards */
    .results{margin-top:10px}
    .lesson-card{
      background:linear-gradient(180deg,var(--card),#0d1533);
      border:1px solid var(--border);
      border-radius:16px;padding:18px;margin:10px 0;
      box-shadow:0 10px 30px rgba(0,0,0,.4);
    }
    .lesson-card h3{
      margin:0 0 8px;color:var(--gold1);font-size:20px;
    }
    .lesson-card p{margin:0 0 6px;line-height:1.6;color:#f6edd3}
    .badge{display:inline-block;margin-top:6px;font-size:11px;padding:4px 8px;
      border-radius:999px;border:1px solid var(--border);
      color:#ffe9a6;background:#1b254b;}

    .muted{color:var(--muted);font-size:13px}
    .status{margin:6px 0;font-size:14px;color:var(--muted)}

    @media(max-width:640px){
      .lock-box{padding:20px}
      .title{font-size:20px}
    }
  </style>
</head>
<body>
  <div class="top">
    <a class="back" href="/">‚Üê Home</a>
    <div class="title">Search Lessons</div>
    <div class="spacer"></div>
  </div>

  <div class="wrap">

    <!-- ======= 10G LOCK OVERLAY ======= -->
    <div id="lockOverlay" class="lock-overlay">
      <div class="lock-box">
        <div class="icon">üîí</div>
        <h2>Unlock Educational Lessons</h2>
        <p>Gain unlimited access to GoldenSpaceAI‚Äôs advanced AI lesson generator ‚Äî delivering complete study explanations, examples, and practice insights for 30 days.</p>
        <div class="price">10G <span>/ month</span></div>
        <div class="balance">Your Golden Balance: <span id="balance">0G</span></div>
        <button id="unlockBtn" class="unlock-btn">UNLOCK FOR 10G/MONTH</button>
        <div id="statusMsg" class="status-message"></div>
        <a href="/buy-golden.html" class="buy-more">üí∞ Buy More Golden</a>
      </div>
    </div>

    <!-- ======= SEARCH INTERFACE ======= -->
    <div id="lessonInterface" style="display:none">
      <div class="searchBox">
        <input id="query" type="text" placeholder="Search lessons ‚Äî e.g. Newton‚Äôs Laws, Photosynthesis, Fractions..." autofocus/>
        <button id="searchBtn" class="btn">Search</button>
      </div>

      <div class="chips" id="chips">
        <div class="chip">Fractions</div>
        <div class="chip">Photosynthesis</div>
        <div class="chip">Newton‚Äôs Laws</div>
        <div class="chip">Grammar Rules</div>
        <div class="chip">Electric Circuits</div>
        <div class="chip">Water Cycle</div>
        <div class="chip">Human Cells</div>
        <div class="chip">The Roman Empire</div>
        <div class="chip">Periodic Table</div>
        <div class="chip">Algebra Basics</div>
      </div>

      <div id="status" class="status">Type a topic or choose one.</div>
      <div id="results" class="results"></div>
    </div>
  </div>

  <script>
    const FEATURE="search_lessons";
    const COST=10;

    const lockOverlay=document.getElementById('lockOverlay');
    const lessonInterface=document.getElementById('lessonInterface');
    const unlockBtn=document.getElementById('unlockBtn');
    const balanceEl=document.getElementById('balance');
    const statusMsg=document.getElementById('statusMsg');
    const q=document.getElementById('query');
    const go=document.getElementById('searchBtn');
    const results=document.getElementById('results');
    const statusEl=document.getElementById('status');

    async function init(){
      try{
        const me=await fetch('/api/me',{credentials:'include'}).then(r=>r.json());
        if(!me.loggedIn){statusMsg.textContent="Please log in.";statusMsg.classList.add('status-error');return;}
        const bal=await fetch('/api/golden-balance',{credentials:'include'}).then(r=>r.json());
        balanceEl.textContent=bal.balance+'G';
        const feat=await fetch(`/api/feature-status?feature=${FEATURE}`,{credentials:'include'}).then(r=>r.json());
        if(feat.unlocked){unlockUI();}else{lockOverlay.style.display='flex';}
      }catch(e){console.error(e);}
    }

    async function unlock(){
      unlockBtn.disabled=true;
      statusMsg.textContent='‚è≥ Processing...';
      try{
        const res=await fetch('/api/unlock-feature',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          credentials:'include',
          body:JSON.stringify({feature:FEATURE,cost:COST})
        });
        const data=await res.json();
        if(data.success){
          statusMsg.textContent='‚úÖ Lessons unlocked!';
          statusMsg.className='status-message status-success';
          setTimeout(()=>unlockUI(),1000);
        }else{
          statusMsg.textContent='‚ùå '+(data.error||'Failed');
          statusMsg.className='status-message status-error';
          unlockBtn.disabled=false;
        }
      }catch(err){
        statusMsg.textContent='‚ùå Network error';
        statusMsg.className='status-message status-error';
        unlockBtn.disabled=false;
      }
    }

    function unlockUI(){
      lockOverlay.style.display='none';
      lessonInterface.style.display='block';
    }

    unlockBtn.onclick=unlock;

    // ========== SEARCH FUNCTION ==========
    async function search(){
      const topic=(q.value||'').trim();
      if(!topic)return;
      go.disabled=true;
      statusEl.textContent='Searching...';
      results.innerHTML='';
      try{
        const res=await fetch('/search-lessons',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({query:`Create a full educational lesson about ${topic}, including introduction, explanation, examples, and practice section.`})
        });
        const data=await res.json();
        const txt=(data.answer||data.reply||'').trim();
        if(!txt){throw new Error('Empty response');}
        renderLesson(txt);
        statusEl.textContent='Completed';
      }catch(err){
        results.innerHTML=`<div class="lesson-card"><p style="color:#ffbdbd">Error: ${err.message}</p></div>`;
        statusEl.textContent='Failed';
      }finally{go.disabled=false;}
    }

    function renderLesson(text){
      const parts=text.split(/\n{2,}/).map(p=>p.trim()).filter(Boolean);
      results.innerHTML=parts.map((p,i)=>`
        <div class="lesson-card">
          <h3>${i===0?'Introduction':'Section '+i}</h3>
          <p>${p}</p>
          <span class="badge">Lesson Generated</span>
        </div>`).join('');
    }

    go.onclick=search;
    q.addEventListener('keydown',e=>{if(e.key==='Enter')search();});
    document.getElementById('chips').onclick=e=>{
      if(e.target.classList.contains('chip')){
        q.value=e.target.textContent;
        search();
      }
    }

    document.addEventListener('DOMContentLoaded',init);
  </script>
</body>
</html>
