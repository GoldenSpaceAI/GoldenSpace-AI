<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI | GoldenSpaceAI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --gold: #FFD700;
            --gold-light: #FFED4E;
            --gold-dark: #E6C200;
            --bg-dark: #0A0F1C;
            --bg-card: #111827;
            --text-primary: #F3F4F6;
            --text-secondary: #9CA3AF;
            --border: #374151;
            --error: #EF4444;
            --warning: #F59E0B;
            --success: #10B981;
            --deep-search-bg: #1E3A8A;
        }

        * {
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: var(--bg-dark);
            color: var(--text-primary);
            height:100vh;
            overflow:hidden;
            display:flex;
        }

        /* ---------------- SIDEBAR ---------------- */
        .sidebar {
            width:300px;
            background:var(--bg-card);
            border-right:1px solid var(--border);
            display:flex;
            flex-direction:column;
            padding-bottom:10px;
        }

        .sidebar-header {
            padding:20px;
            border-bottom:1px solid var(--border);
            display:flex;
            align-items:center;
            gap:12px;
        }

        .logo {
            width:40px;
            height:40px;
            border-radius:10px;
            background:linear-gradient(135deg,var(--gold),var(--gold-light));
            display:flex;
            align-items:center;
            justify-content:center;
            color:var(--bg-dark);
            font-size:20px;
        }

        .new-chat-btn,
        .custom-instructions-btn {
            margin:15px;
            padding:12px 15px;
            border-radius:10px;
            cursor:pointer;
            display:flex;
            align-items:center;
            gap:10px;
            font-weight:600;
            transition:0.2s;
        }

        .new-chat-btn {
            background:var(--bg-dark);
            color:var(--gold);
            border:1px solid var(--gold);
        }

        .new-chat-btn:hover{
            background:rgba(255,215,0,0.1);
        }

        .custom-instructions-btn {
            background:linear-gradient(135deg,var(--gold),var(--gold-light));
            color:var(--bg-dark);
        }

        .custom-instructions-btn:hover {
            transform:translateY(-2px);
        }

        .chat-history {
            flex:1;
            overflow-y:auto;
            padding:10px;
        }

        .chat-item {
            padding:12px 15px;
            border-radius:8px;
            margin-bottom:8px;
            cursor:pointer;
            display:flex;
            justify-content:space-between;
            border:1px solid transparent;
        }

        .chat-item:hover {
            background:rgba(255,215,0,0.05);
            border-color:var(--gold);
        }

        .chat-item.active {
            background:rgba(255,215,0,0.1);
            border-color:var(--gold);
        }

        .delete-chat-btn {
            background:none;
            border:none;
            color:var(--text-secondary);
            cursor:pointer;
            opacity:0;
            transition:0.2s;
        }

        .chat-item:hover .delete-chat-btn {
            opacity:1;
        }

        /* ---------------- MAIN CONTENT ---------------- */
        .main-content {
            flex:1;
            display:flex;
            flex-direction:column;
            overflow:hidden;
        }

        .header {
            padding:15px 25px;
            border-bottom:1px solid var(--border);
            background:var(--bg-card);
            display:flex;
            justify-content:space-between;
            align-items:center;
        }

        .model-selector {
            display:flex;
            gap:10px;
        }

        .model-btn {
            padding:8px 14px;
            border-radius:20px;
            font-size:14px;
            border:1px solid var(--border);
            background:rgba(255,255,255,0.05);
            cursor:pointer;
            color:var(--text-primary);
            transition:0.2s;
        }

        .model-btn.active {
            background:linear-gradient(135deg,var(--gold),var(--gold-light));
            color:var(--bg-dark);
            border-color:var(--gold);
            font-weight:600;
        }

        /* ---------------- CHAT AREA ---------------- */
        .chat-container {
            flex:1;
            overflow-y:auto;
            padding:20px;
            display:flex;
            flex-direction:column;
            gap:20px;
        }

        .message {
            max-width:80%;
            padding:15px 20px;
            border-radius:18px;
            border:1px solid transparent;
            line-height:1.5;
        }

        .user-message {
            align-self:flex-end;
            background:linear-gradient(135deg,var(--gold),var(--gold-light));
            color:var(--bg-dark);
            border-bottom-right-radius:5px;
            font-weight:600;
        }

        .ai-message {
            align-self:flex-start;
            background:var(--bg-card);
            border:1px solid var(--border);
            border-bottom-left-radius:5px;
        }

        .deep-search-message {
            background:var(--deep-search-bg);
            color:white;
            border-color:var(--gold);
        }

        .message-header{
            display:flex;
            align-items:center;
            gap:8px;
            margin-bottom:8px;
            opacity:0.8;
        }

        /* ---------------- FEATURES ---------------- */
        .features {
            display:flex;
            gap:15px;
            padding:10px 20px;
            border-top:1px solid var(--border);
            background:var(--bg-card);
        }

        .feature-btn {
            padding:8px 15px;
            background:rgba(255,255,255,0.05);
            border:1px solid var(--border);
            color:var(--text-primary);
            border-radius:20px;
            cursor:pointer;
            font-size:14px;
            transition:0.2s;
            display:flex;
            gap:5px;
            align-items:center;
        }

        .feature-btn:hover {
            background:rgba(255,215,0,0.1);
            border-color:var(--gold);
            color:var(--gold);
        }

        .feature-btn.active {
            background:linear-gradient(135deg,var(--gold),var(--gold-light));
            color:var(--bg-dark);
        }

        /* ---------------- INPUT AREA ---------------- */
        .input-area {
            padding:20px;
            border-top:1px solid var(--border);
            background:var(--bg-card);
            display:flex;
            gap:12px;
        }

        .input-container {
            flex:1;
            display:flex;
            border-radius:20px;
            padding:5px;
            background:rgba(255,255,255,0.05);
            border:1px solid var(--border);
        }

        .input-container:focus-within {
            border-color:var(--gold);
            box-shadow:0 0 0 2px rgba(255,215,0,0.1);
        }

        textarea {
            flex:1;
            resize:none;
            background:none;
            border:none;
            color:var(--text-primary);
            padding:10px 15px;
            font-size:16px;
            outline:none;
        }

        .send-btn {
            width:40px;
            height:40px;
            border-radius:50%;
            background:linear-gradient(135deg,var(--gold),var(--gold-light));
            border:none;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            color:var(--bg-dark);
            font-size:18px;
        }

        /* ---------------- THINKING ANIMATION ---------------- */
        .thinking-indicator {
            display:flex;
            gap:5px;
            padding:15px 20px;
            background:var(--bg-card);
            border-radius:18px;
            width:fit-content;
            align-self:flex-start;
        }

        .thinking-dot {
            width:8px;
            height:8px;
            border-radius:50%;
            background:var(--gold);
            animation: bounce 1.2s infinite ease-in-out;
        }

        .thinking-dot:nth-child(2){animation-delay:-0.2s;}
        .thinking-dot:nth-child(3){animation-delay:-0.1s;}

        @keyframes bounce {
            0%,80%,100%{ transform: scale(0.8); opacity:0.5; }
            40%{ transform: scale(1); opacity:1; }
        }

    </style>
</head>
<script>
/* ============================================================
    GOLDENSPACEAI â€¢ ADVANCED AI ASSISTANT (NEW VERSION)
    WITH:
    - PRO / FLASH / THINKING MODELS
    - TYPING ANIMATION
    - THINKING LOADER
    - VOICE, IMAGE, DEEP SEARCH
    - CHAT HISTORY SYSTEM
============================================================ */

document.addEventListener("DOMContentLoaded", () => {

    /* ---------- DOM ELEMENTS ---------- */
    const chatContainer = document.getElementById("chatContainer");
    const messageInput = document.getElementById("messageInput");
    const sendButton = document.getElementById("sendButton");
    const newChatBtn = document.getElementById("newChatBtn");
    const chatHistory = document.getElementById("chatHistory");
    const modelButtons = document.querySelectorAll(".model-btn");
    const currentModelDisplay = document.getElementById("currentModelDisplay");

    const deepSearchBtn = document.getElementById("deepSearchBtn");
    const imageGenBtn = document.getElementById("imageGenBtn");
    const uploadImageBtn = document.getElementById("uploadImageBtn");
    const voiceChatBtn = document.getElementById("voiceChatBtn");
    const fileInput = document.getElementById("fileInput");

    const tokenCounter = document.getElementById("tokenCounter");

    /* ---------- CHAT STATE ---------- */
    let chats = JSON.parse(localStorage.getItem("golden_ai_chats")) || {};
    let currentChatId = null;
    let currentTokenCount = 0;
    let isDeepSearch = false;

    /* ---------- MODEL SYSTEM ---------- */

    // Saved model or default = PRO
    let currentModel = localStorage.getItem("golden_model") || "pro";

    const modelEndpoints = {
        pro: "/api/generate-gpt4.1",         // GPT-4.1
        flash: "/api/generate-gpt5-nano",    // GPT-5 Nano
        thinking: "/api/generate-gpt5"       // GPT-5 Full
    };

    const modelDisplayNames = {
        pro: "PRO (GPT-4.1)",
        flash: "FLASH (GPT-5 Nano)",
        thinking: "THINKING (GPT-5)"
    };

    /* ============================================================
       1. MODEL SELECTOR
    ============================================================ */

    function updateModelButtons() {
        modelButtons.forEach(btn => {
            btn.classList.toggle("active", btn.dataset.model === currentModel);
        });
        currentModelDisplay.textContent = modelDisplayNames[currentModel];
    }

    modelButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            currentModel = btn.dataset.model;
            localStorage.setItem("golden_model", currentModel);
            updateModelButtons();
        });
    });

    updateModelButtons();


    /* ============================================================
       2. CHAT HISTORY SYSTEM
    ============================================================ */

    function saveChats() {
        localStorage.setItem("golden_ai_chats", JSON.stringify(chats));
    }

    function loadChatHistory() {
        chatHistory.innerHTML = "";
        Object.values(chats).forEach(chat => {
            const el = document.createElement("div");
            el.className = `chat-item ${chat.id === currentChatId ? "active" : ""}`;
            el.innerHTML = `
                <div style="display:flex;align-items:center;gap:10px;">
                    <i class="fas fa-comment"></i>
                    <span>${chat.title}</span>
                </div>
                <button class="delete-chat-btn" data-id="${chat.id}">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            el.addEventListener("click", (e) => {
                if (!e.target.closest(".delete-chat-btn")) {
                    loadChat(chat.id);
                }
            });

            el.querySelector(".delete-chat-btn").addEventListener("click", (e) => {
                e.stopPropagation();
                delete chats[chat.id];
                saveChats();
                if (chat.id === currentChatId) createNewChat();
                loadChatHistory();
            });

            chatHistory.appendChild(el);
        });
    }

    function createNewChat() {
        const id = "chat_" + Date.now();
        currentChatId = id;
        currentTokenCount = 0;

        chats[id] = {
            id,
            title: "New Chat",
            model: currentModel,
            messages: [],
            tokenCount: 0
        };

        saveChats();
        loadChatHistory();
        loadChat(id);
    }

    function loadChat(id) {
        currentChatId = id;
        const chat = chats[id];
        if (!chat) return;

        chatContainer.innerHTML = "";
        currentTokenCount = chat.tokenCount || 0;
        updateTokenCounter();

        chat.messages.forEach(msg => renderMessage(msg));
        loadChatHistory();

        chatContainer.scrollTop = chatContainer.scrollHeight;
        updateModelButtons();
    }

    /* ============================================================
       3. MESSAGE RENDERING
    ============================================================ */

    function renderMessage(msg) {
        const div = document.createElement("div");
        div.className = `message ${msg.role}-message`;

        const header = document.createElement("div");
        header.className = "message-header";

        if (msg.role === "ai") {
            header.innerHTML = `<i class="fas fa-robot"></i> <span>${modelDisplayNames[msg.model]}</span>`;
        } else {
            header.innerHTML = `<i class="fas fa-user"></i> You`;
        }

        div.appendChild(header);

        const text = document.createElement("div");
        text.textContent = msg.content;
        div.appendChild(text);

        chatContainer.appendChild(div);
    }

    /* ============================================================
       4. THINKING ANIMATION
    ============================================================ */

    function showThinking() {
        hideThinking();

        const think = document.createElement("div");
        think.className = "thinking-indicator";
        think.id = "thinkingIndicator";

        think.innerHTML = `
            <div class="thinking-dot"></div>
            <div class="thinking-dot"></div>
            <div class="thinking-dot"></div>
        `;

        chatContainer.appendChild(think);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function hideThinking() {
        const el = document.getElementById("thinkingIndicator");
        if (el) el.remove();
    }

    /* ============================================================
       5. TYPING EFFECT
    ============================================================ */

    function typeWriterEffect(el, text, speed = 15) {
        return new Promise(resolve => {
            let i = 0;
            function type() {
                if (i < text.length) {
                    el.textContent += text.charAt(i);
                    i++;
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    setTimeout(type, speed);
                } else {
                    resolve();
                }
            }
            type();
        });
    }

    /* ============================================================
   6. SEND MESSAGE
============================================================ */

async function sendMessage() {
    const text = messageInput.value.trim();
    if (!text) return;

    // Limit message to 1000 characters
    if (text.length > 1000) {
        alert("Your message is too long! Max allowed is 1000 characters.");
        return;
    }

    // Estimate tokens
    const tokenEstimate = Math.ceil(text.length / 4);

    if (currentTokenCount + tokenEstimate > 250000) {
        alert("Token limit reached for this chat.");
        return;
    }

    currentTokenCount += tokenEstimate;
    updateTokenCounter();

    // Add user message
    addMessageToChat(text, "user");

    messageInput.value = "";
    messageInput.style.height = "auto";

    showThinking();

    try {
        const response = await fetch(modelEndpoints[currentModel], {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                messages: chats[currentChatId].messages.map(m => ({
                    role: m.role === "ai" ? "assistant" : "user",
                    content: m.content
                }))
            })
        });

        const data = await response.json();
        hideThinking();

        // AI typing display
        const aiDiv = document.createElement("div");
        aiDiv.className = "message ai-message";
        aiDiv.innerHTML = `
            <div class="message-header">
                <i class="fas fa-robot"></i>
                <span>${modelDisplayNames[currentModel]}</span>
            </div>
            <div class="typing-area"></div>
        `;

        chatContainer.appendChild(aiDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        const target = aiDiv.querySelector(".typing-area");

        await typeWriterEffect(target, data.text);
        addMessageToChat(data.text, "ai");

    } catch (err) {
        hideThinking();
        addMessageToChat("Error contacting AI.", "ai");
    }
}

    function addMessageToChat(content, role) {
        const msg = {
            role,
            content,
            model: currentModel,
            timestamp: Date.now()
        };

        chats[currentChatId].messages.push(msg);

        if (role === "user" && chats[currentChatId].messages.length === 1) {
            chats[currentChatId].title = content.substring(0, 25) + "...";
        }

        chats[currentChatId].tokenCount = currentTokenCount;
        saveChats();

        renderMessage(msg);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    /* ============================================================
       7. TOKEN COUNTER
    ============================================================ */

    function updateTokenCounter() {
        tokenCounter.textContent =
            `Tokens: ${currentTokenCount.toLocaleString()}/250,000`;
    }

    /* ============================================================
       8. INPUT + ENTER KEY
    ============================================================ */

    sendButton.addEventListener("click", sendMessage);

    messageInput.addEventListener("keydown", e => {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    /* ============================================================
       INIT PAGE
    ============================================================ */

    if (Object.keys(chats).length === 0) {
        createNewChat();
    } else {
        loadChat(Object.keys(chats)[0]);
    }

});
</script>
