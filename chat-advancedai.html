<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GoldenSpaceAI ¬∑ Advanced Assistant</title>
<style>
:root {
  --gold1: #ffd700;
  --gold2: #ffed4e;
  --text-dark: #f5f5f5;
  --text-light: #1b1b1b;
  --bg-dark: #05060a;
  --bg-light: #faf9f6;
  --blur-bg: rgba(0,0,0,0.5);
  --border: rgba(255,255,255,0.1);
  --radius: 16px;
}

/* ===== Global ===== */
body {
  margin: 0;
  font-family: "Segoe UI", system-ui, sans-serif;
  color: var(--text-dark);
  background: var(--bg-dark)
    url("https://goldenspaceai.space/wallpaper-galaxy.png") center/cover fixed;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  transition: all 0.4s ease;
}
body.light {
  color: var(--text-light);
  background: var(--bg-light)
    url("https://goldenspaceai.space/wallpaper-light.jpg") center/cover fixed;
}

/* ===== Header ===== */
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 22px;
  background: var(--blur-bg);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border);
}
.brand {
  display: flex;
  align-items: center;
  gap: .6rem;
  font-weight: 800;
}
.logo {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: conic-gradient(from 210deg, var(--gold1), var(--gold2));
  box-shadow: 0 0 20px rgba(255,215,0,0.4);
}
.badge {
  font-size: .8rem;
  background: linear-gradient(180deg, var(--gold1), var(--gold2));
  color: #1a1300;
  padding: 4px 10px;
  border-radius: 999px;
  font-weight: 700;
}
.theme-toggle {
  border: none;
  background: rgba(255,255,255,0.1);
  color: var(--text-dark);
  padding: 8px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 700;
  transition: 0.3s;
}
.theme-toggle:hover {
  background: rgba(255,255,255,0.2);
}

/* ===== Chat ===== */
main {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  scroll-behavior: smooth;
}
.msg {
  max-width: min(760px, 92%);
  padding: 12px 16px;
  margin: 10px auto;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  backdrop-filter: blur(6px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  line-height: 1.55;
}
.msg.user {
  background: linear-gradient(180deg, rgba(255,215,0,0.15), rgba(255,215,0,0.1));
  border-color: rgba(255,215,0,0.35);
}
.msg.ai {
  background: rgba(12,12,20,0.6);
}
.msg small {
  display: block;
  opacity: .7;
  font-size: .75rem;
  margin-bottom: 4px;
}
.tools {
  display: flex;
  margin-top: 8px;
}
.speak-btn {
  background: linear-gradient(45deg, var(--gold1), var(--gold2));
  color: #141200;
  font-weight: 700;
  border: none;
  border-radius: 10px;
  padding: 6px 12px;
  cursor: pointer;
  box-shadow: 0 0 14px rgba(255,215,0,0.3);
}

/* ===== Composer ===== */
.composer-wrap {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: var(--blur-bg);
  backdrop-filter: blur(12px);
  padding: 12px 0;
  border-top: 1px solid var(--border);
}
.composer {
  width: min(940px, 94%);
  margin: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
textarea {
  resize: none;
  min-height: 56px;
  max-height: 140px;
  border-radius: 10px;
  padding: 10px 14px;
  font-size: 15px;
  border: 1px solid rgba(255,255,255,0.2);
  background: rgba(255,255,255,0.08);
  color: var(--text-dark);
}
.actions {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}
.act-btn {
  flex: 1 1 140px;
  max-width: 160px;
  text-align: center;
  padding: 12px 0;
  border-radius: 12px;
  font-weight: 700;
  border: 1px solid rgba(255,215,0,0.35);
  background: rgba(255,215,0,0.08);
  color: var(--gold1);
  cursor: pointer;
  transition: all 0.25s;
}
.act-btn:hover {
  background: rgba(255,215,0,0.15);
}
.act-btn.active {
  background: linear-gradient(45deg, var(--gold1), var(--gold2));
  color: #141200;
  box-shadow: 0 0 18px rgba(255,215,0,0.4);
}

/* ===== Lock Overlay ===== */
#lockOverlay {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: center;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(16px);
  z-index: 9999;
  color: #fff;
  text-align: center;
}
.lock-box {
  background: linear-gradient(145deg, rgba(15,15,20,0.95), rgba(8,8,10,0.9));
  border: 2px solid rgba(255,215,0,0.45);
  border-radius: 20px;
  padding: 40px 35px;
  box-shadow: 0 0 40px rgba(255,215,0,0.25);
  max-width: 440px;
  width: 92%;
}
.lock-icon {
  font-size: 3.4rem;
  color: gold;
  text-shadow: 0 0 20px rgba(255,215,0,0.7);
  animation: pulse 2s infinite ease-in-out;
}
@keyframes pulse {
  0%,100% {transform: scale(1);}
  50% {transform: scale(1.1);}
}
.lock-title {
  font-size: 1.8rem;
  font-weight: 800;
  margin-top: 10px;
  color: gold;
}
.lock-desc {
  margin: 18px 0 26px;
  color: #ccc;
  line-height: 1.6;
  font-size: 1rem;
}
.unlock-btn {
  background: linear-gradient(45deg, var(--gold1), var(--gold2));
  border: none;
  color: #141200;
  padding: 14px 36px;
  font-size: 1.1rem;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 0 25px rgba(255,215,0,0.35);
}
.unlock-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 40px rgba(255,215,0,0.5);
}
.lock-msg {
  margin-top: 10px;
  font-size: 0.9rem;
  color: #ccc;
}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo"></div> <span>GoldenSpaceAI</span>
    <span class="badge">Advanced Assistant</span>
  </div>
  <button id="themeToggle" class="theme-toggle">üåô Dark Mode</button>
</header>

<div id="lockOverlay">
  <div class="lock-box">
    <div class="lock-icon">üîí</div>
    <div class="lock-title">Advanced AI Access</div>
    <div class="lock-desc">
      Unlock <b>Chat-AdvancedAI</b> for <b>20 G / month</b><br>
      Includes Deep Think (GPT-5-mini), File Vision, and Voice Chat.
    </div>
    <button id="unlockBtn" class="unlock-btn">Unlock for 20 G</button>
    <div id="lockMsg" class="lock-msg"></div>
  </div>
</div>

<main id="chat">
  <div class="msg ai">
    <small>GoldenSpaceAI</small>
    Welcome to Advanced Chat ‚Äî start typing, or use one of the tools below.
  </div>
</main>

<div class="composer-wrap">
  <div class="composer">
    <textarea id="prompt" placeholder="Type your message... (Shift + Enter = newline)"></textarea>
    <div class="actions">
      <button class="act-btn" id="deepBtn">Deep Think</button>
      <button class="act-btn" id="uploadBtn">Upload File</button>
      <button class="act-btn" id="micBtn">Voice</button>
      <button class="act-btn" id="sendBtn">Send</button>
    </div>
  </div>
</div>

<script>
const chat=document.getElementById("chat"),promptEl=document.getElementById("prompt");
const deepBtn=document.getElementById("deepBtn"),uploadBtn=document.getElementById("uploadBtn"),
micBtn=document.getElementById("micBtn"),sendBtn=document.getElementById("sendBtn");
const BACKEND="/chat-advanced-ai";
let currentMode=null,fileData=null,recorder,chunks=[],recording=false;

/* Theme toggle */
document.getElementById("themeToggle").onclick=()=>{
  document.body.classList.toggle("light");
  const isLight=document.body.classList.contains("light");
  document.getElementById("themeToggle").textContent=isLight?"üåû Light Mode":"üåô Dark Mode";
};

/* Lock overlay */
async function checkAccess(){
  const r=await fetch("/api/feature-status?feature=chat_advancedai");
  const j=await r.json();
  document.getElementById("lockOverlay").style.display=j.unlocked?"none":"flex";
}
document.getElementById("unlockBtn").onclick=async()=>{
  const m=document.getElementById("lockMsg");
  m.textContent="Processing...";
  const r=await fetch("/api/unlock-feature",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({feature:"chat_advancedai",cost:20})});
  const j=await r.json();
  if(j.success){m.textContent="‚úÖ Unlocked!";setTimeout(()=>location.reload(),1000);}
  else m.textContent="‚ùå "+(j.error||"Failed");
};
checkAccess();

/* Chat helpers */
function addMsg(role,text){
  const m=document.createElement("div");
  m.className="msg "+role;
  m.innerHTML=`<small>${role==="user"?"You":"GoldenSpaceAI"}</small><div>${text.replace(/\n/g,"<br>")}</div>`;
  if(role==="ai"){
    const t=document.createElement("div");t.className="tools";
    const s=document.createElement("button");s.className="speak-btn";s.textContent="üîä Speak";
    s.onclick=()=>speechSynthesis.speak(new SpeechSynthesisUtterance(text));
    t.appendChild(s);m.appendChild(t);
  }
  chat.appendChild(m);chat.scrollTop=chat.scrollHeight;
}
function spinner(){const s=document.createElement("div");s.className="msg ai";s.innerHTML='<div class="spinner"></div>';
  chat.appendChild(s);chat.scrollTop=chat.scrollHeight;return s;}
function activate(btn){[deepBtn,uploadBtn,micBtn].forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");currentMode=btn.id;}
function deactivate(){[deepBtn,uploadBtn,micBtn].forEach(b=>b.classList.remove("active"));currentMode=null;fileData=null;}

/* Buttons */
deepBtn.onclick=()=>activate(deepBtn);
uploadBtn.onclick=()=>{const i=document.createElement("input");i.type="file";
  i.onchange=e=>{fileData=e.target.files[0];activate(uploadBtn);};i.click();};
micBtn.onclick=async()=>{
  if(!recording){const s=await navigator.mediaDevices.getUserMedia({audio:true});
    recorder=new MediaRecorder(s);chunks=[];
    recorder.ondataavailable=e=>chunks.push(e.data);
    recorder.onstop=async()=>{
      const b=new Blob(chunks,{type:"audio/webm"});const f=new FormData();f.append("audio",b,"speech.webm");
      const r=await fetch("/api/transcribe",{method:"POST",body:f});const j=await r.json();
      promptEl.value=j.text||"";deactivate();
    };
    recorder.start();recording=true;micBtn.classList.add("active");
  }else{recorder.stop();recording=false;}
};

/* Send */
sendBtn.onclick=async()=>{
  const text=promptEl.value.trim();if(!text)return;
  addMsg("user",text);const spin=spinner();
  const fd=new FormData();let model="gpt-4o";
  if(currentMode==="deepBtn")model="gpt-5-mini";
  if(fileData)fd.append("image",fileData);
  fd.append("q",text);fd.append("model",model);
  const r=await fetch(BACKEND,{method:"POST",body:fd});const j=await r.json();
  chat.removeChild(spin);addMsg("ai",j.reply||j.error||"[No reply]");
  deactivate();promptEl.value="";
};
promptEl.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendBtn.click();}
});
</script>
</body>
</html>
