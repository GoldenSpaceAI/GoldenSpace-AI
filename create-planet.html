<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GoldenSpaceAI ¬∑ Create Your Planet</title>
<style>
  :root{
    --bg:#0b0f14;
    --panel:#121821;
    --panel-2:#0e141c;
    --border:#1f2937;
    --gold:#f5c542;
    --gold-2:#d9aa18;
    --text:#dbe5f7;
    --muted:#98a6be;
    --good:#37d399;
    --warn:#f59e0b;
    --bad:#ef4444;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    background:
      radial-gradient(1200px 600px at 80% -10%, rgba(245,197,66,.12), transparent 60%),
      radial-gradient(1000px 500px at -10% 0%, rgba(245,197,66,.08), transparent 60%),
      var(--bg);
    color:var(--text);
  }
  header{
    position:sticky; top:0; z-index:10;
    backdrop-filter: blur(8px);
    background:linear-gradient(to bottom, rgba(11,15,20,.85), rgba(11,15,20,.55));
    border-bottom:1px solid var(--border);
  }
  .bar{
    max-width:1200px; margin:0 auto; padding:14px 18px;
    display:flex; align-items:center; gap:14px;
  }
  .back{
    display:inline-flex; align-items:center; gap:10px;
    padding:10px 14px; border-radius:12px;
    color:var(--text); text-decoration:none; font-weight:600;
    background:linear-gradient(180deg, #1a2431, #111824);
    border:1px solid var(--border);
    box-shadow: var(--shadow);
  }
  .back .chev{font-size:18px; opacity:.9}
  .title{
    font-weight:800; letter-spacing:.3px; font-size:18px;
    color:var(--gold);
  }

  .wrap{max-width:1200px; margin:28px auto; padding:0 18px; display:grid; gap:18px; grid-template-columns: 1.25fr 1fr;}
  @media (max-width:980px){ .wrap{grid-template-columns: 1fr; } }

  .panel{
    background:linear-gradient(180deg, var(--panel), var(--panel-2));
    border:1px solid var(--border);
    border-radius:16px; padding:18px; box-shadow: var(--shadow);
  }
  .panel h2{
    margin:0 0 12px; font-size:18px; font-weight:800; color:var(--gold);
  }
  .panel p.sub{margin:0 0 14px; color:var(--muted); font-size:14px}

  .grid{display:grid; gap:14px; grid-template-columns: repeat(2, minmax(0,1fr));}
  @media (max-width:700px){ .grid{grid-template-columns:1fr;} }

  .field{display:flex; flex-direction:column; gap:8px}
  label{font-size:13px; color:var(--muted)}
  input[type="text"], select{
    background:#0c1219; color:var(--text); border:1px solid var(--border);
    padding:12px 12px; border-radius:12px; outline:0;
  }
  input[type="range"]{
    -webkit-appearance:none; height:6px; border-radius:999px; outline:0;
    background:linear-gradient(90deg, var(--gold), var(--gold-2));
  }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; width:22px; height:22px; border-radius:50%;
    background:#0c1219; border:2px solid var(--gold); box-shadow:0 0 0 4px rgba(245,197,66,.2);
  }
  .row{display:flex; align-items:center; justify-content:space-between; gap:14px}
  .val{min-width:72px; text-align:right; color:var(--gold); font-weight:700}

  .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
  .btn{
    border:1px solid var(--border); border-radius:12px; padding:10px 14px;
    background:linear-gradient(180deg, #1a2431, #111824); color:var(--text);
    text-decoration:none; font-weight:700; cursor:pointer;
  }
  .btn.gold{border-color:#7c5b05; background:linear-gradient(180deg, #f8d772, #e7b72f); color:#111;}
  .btn.ghost{background:transparent}

  /* Preview side */
  .canvas-wrap{display:grid; gap:14px; grid-template-columns: 1fr;}
  .planet-canvas{width:100%; aspect-ratio:1/1; background:#0a0f15; border-radius:16px; border:1px solid var(--border)}
  .specs{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px}
  .spec{
    background:#0b1219; border:1px solid var(--border);
    border-radius:12px; padding:12px;
  }
  .spec .k{color:var(--muted); font-size:12px}
  .spec .v{font-weight:800; margin-top:2px}
  .notice{font-size:12px; color:var(--muted); margin-top:6px}

  footer{max-width:1200px; margin:10px auto 28px; padding:0 18px; color:var(--muted); font-size:12px}
</style>
</head>
<body>
  <!-- ==================== GOLDEN UNLOCK OVERLAY ==================== -->
<div id="goldenOverlay" class="golden-overlay">
  <div class="golden-unlock">
    <div class="lock-icon">üîí</div>
    <h2>Unlock This Feature</h2>
    <p class="description">Access this premium feature for 30 days</p>
    <div class="price">4G <span>per month</span></div>
    <div class="balance-info">Your balance: <span id="userBalance">0</span>G</div>
    <button class="unlock-btn" onclick="unlockFeature()">UNLOCK FOR 4G</button>
    <div id="statusMessage"></div>
    <div class="links">
      <a href="/buy-golden.html">Need Golden? Buy here</a>
      <a href="/">Back to Home</a>
    </div>
  </div>
</div>

<style>
.golden-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
  background: rgba(11, 16, 32, 0.95); backdrop-filter: blur(10px);
  display: flex; align-items: center; justify-content: center; z-index: 10000;
}
.golden-unlock {
  background: linear-gradient(135deg, #0f1624, #0b1320); border: 2px solid #f6c64a;
  border-radius: 20px; padding: 30px; text-align: center; max-width: 400px; width: 90%;
}
.lock-icon { font-size: 60px; margin-bottom: 15px; }
.golden-unlock h2 { color: #f6c64a; margin-bottom: 10px; }
.description { color: #cfc6a5; margin-bottom: 20px; }
.price { font-size: 36px; font-weight: bold; color: #f6c64a; margin: 15px 0; }
.price span { font-size: 16px; color: #cfc6a5; }
.balance-info { color: #cfc6a5; margin: 10px 0; }
.unlock-btn {
  background: linear-gradient(135deg, #f6c64a, #eb8b36); color: #1a1300;
  border: none; border-radius: 10px; padding: 12px 30px; font-size: 16px;
  font-weight: bold; cursor: pointer; margin: 10px 0; width: 100%;
}
.links { margin-top: 15px; }
.links a { color: #f6c64a; margin: 0 10px; }
#statusMessage { margin: 10px 0; min-height: 20px; }
</style>

<script>
// Get current page feature name
function getFeatureName() {
  const path = window.location.pathname;
  if (path.includes('search-info')) return 'search_info';
  if (path.includes('learn-physics')) return 'learn_physics';
  if (path.includes('create-planet')) return 'create_planet';
  if (path.includes('create-advanced-planet')) return 'advanced_planet';
  if (path.includes('create-rocket')) return 'create_rocket';
  if (path.includes('create-satellite')) return 'create_satellite';
  if (path.includes('your-space')) return 'your_space';
  return 'unknown';
}

async function checkAccess() {
  try {
    const userRes = await fetch('/api/me', { credentials: 'include' });
    const userData = await userRes.json();
    
    if (!userData.loggedIn) {
      window.location.href = '/login-signup.html';
      return;
    }

    const feature = getFeatureName();
    const featureRes = await fetch(`/api/feature-status?feature=${feature}`, {
      credentials: 'include'
    });
    
    if (featureRes.ok) {
      const featureData = await featureRes.json();
      if (featureData.unlocked) {
        document.getElementById('goldenOverlay').style.display = 'none';
      }
    }

    // Load balance
    const balanceRes = await fetch('/api/golden-balance', { credentials: 'include' });
    const balanceData = await balanceRes.json();
    document.getElementById('userBalance').textContent = balanceData.balance;
    
  } catch (error) {
    console.error('Access check failed:', error);
  }
}

async function unlockFeature() {
  const btn = document.querySelector('.unlock-btn');
  const status = document.getElementById('statusMessage');
  
  btn.disabled = true;
  btn.textContent = 'Processing...';
  status.textContent = '';
  
  try {
    const feature = getFeatureName();
    const response = await fetch('/api/unlock-feature', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ feature: feature, cost: 4 })
    });
    
    const data = await response.json();
    
    if (data.success) {
      status.textContent = '‚úÖ Unlocked! Loading...';
      status.style.color = '#90ee90';
      setTimeout(() => {
        document.getElementById('goldenOverlay').style.display = 'none';
      }, 1000);
    } else {
      status.textContent = '‚ùå ' + data.error;
      status.style.color = '#ff6b6b';
      btn.disabled = false;
      btn.textContent = 'UNLOCK FOR 4G';
    }
  } catch (error) {
    status.textContent = '‚ùå Network error';
    status.style.color = '#ff6b6b';
    btn.disabled = false;
    btn.textContent = 'UNLOCK FOR 4G';
  }
}

// Check access when page loads
document.addEventListener('DOMContentLoaded', checkAccess);
</script>  <header>
    <div class="bar">
      <a class="back" href="/"><span class="chev">‚üµ</span><span>Home</span></a>
      <div class="title">Create Your Planet</div>
    </div>
  </header>

  <main class="wrap">
    <!-- Left: controls -->
    <section class="panel">
      <h2>Designer</h2>
      <p class="sub">Tune the knobs. Your planet preview updates live.</p>

      <div class="grid">
        <div class="field">
          <label>Planet name</label>
          <input id="name" type="text" placeholder="e.g., Auralis Prime" value="Auralis Prime" oninput="updatePreview()">
        </div>

        <div class="field">
          <label>Planet type</label>
          <select id="type" onchange="updatePreview()">
            <option>Terrestrial</option>
            <option>Ice world</option>
            <option>Desert world</option>
            <option>Ocean world</option>
            <option>Gas giant</option>
            <option>Super-Earth</option>
            <option>Mini-Neptune</option>
            <option>Lava world</option>
          </select>
        </div>

        <div class="field">
          <label class="row"><span>Radius (km)</span><span class="val" id="radiusVal">6,371</span></label>
          <input id="radius" type="range" min="1500" max="70000" value="6371" oninput="updatePreview()">
        </div>

        <div class="field">
          <label class="row"><span>Average temperature (¬∞C)</span><span class="val" id="tempVal">15</span></label>
          <input id="temp" type="range" min="-180" max="500" value="15" oninput="updatePreview()">
        </div>

        <div class="field">
          <label class="row"><span>Surface water (%)</span><span class="val" id="waterVal">71</span></label>
          <input id="water" type="range" min="0" max="100" value="71" oninput="updatePreview()">
        </div>

        <div class="field">
          <label class="row"><span>Atmosphere density</span><span class="val" id="atmVal">1.0√óEarth</span></label>
          <input id="atm" type="range" min="0" max="300" value="100" oninput="updatePreview()">
        </div>

        <div class="field">
          <label class="row"><span>Gravity (g)</span><span class="val" id="gravVal">1.00</span></label>
          <input id="grav" type="range" min="20" max="300" value="100" oninput="updatePreview()">
        </div>

        <div class="field">
          <label class="row"><span>Number of moons</span><span class="val" id="moonsVal">1</span></label>
          <input id="moons" type="range" min="0" max="8" value="1" oninput="updatePreview()">
        </div>

        <div class="field">
          <label class="row"><span>Has rings?</span><span class="val" id="ringsVal">No</span></label>
          <input id="rings" type="range" min="0" max="1" value="0" oninput="updatePreview()">
        </div>

        <div class="field" style="grid-column:1/-1">
          <label>Atmosphere composition (percent)</label>
          <div class="grid">
            <div class="field">
              <label class="row"><span>N‚ÇÇ (Nitrogen)</span><span class="val" id="n2Val">78</span></label>
              <input id="n2" type="range" min="0" max="100" value="78" oninput="syncAtmo(this)">
            </div>
            <div class="field">
              <label class="row"><span>O‚ÇÇ (Oxygen)</span><span class="val" id="o2Val">21</span></label>
              <input id="o2" type="range" min="0" max="100" value="21" oninput="syncAtmo(this)">
            </div>
            <div class="field">
              <label class="row"><span>Other gases</span><span class="val" id="traceVal">1</span></label>
              <input id="trace" type="range" min="0" max="100" value="1" oninput="syncAtmo(this)">
            </div>
          </div>
          <div class="notice" id="atmoWarn"></div>
        </div>
      </div>

      <div class="actions">
        <button class="btn gold" onclick="exportJSON()">Export JSON</button>
        <button class="btn" onclick="randomize()">üé≤ Randomize</button>
        <button class="btn ghost" onclick="resetDefaults()">Reset</button>
      </div>
    </section>

    <!-- Right: preview -->
    <aside class="panel">
      <h2>Preview</h2>
      <div class="canvas-wrap">
        <canvas id="planet" class="planet-canvas" width="900" height="900"></canvas>

        <div class="specs">
          <div class="spec"><div class="k">Name</div><div class="v" id="specName">Auralis Prime</div></div>
          <div class="spec"><div class="k">Type</div><div class="v" id="specType">Terrestrial</div></div>
          <div class="spec"><div class="k">Radius</div><div class="v" id="specRadius">6,371 km</div></div>
          <div class="spec"><div class="k">Gravity</div><div class="v" id="specGrav">1.00 g</div></div>
          <div class="spec"><div class="k">Temperature</div><div class="v" id="specTemp">15 ¬∞C</div></div>
          <div class="spec"><div class="k">Water</div><div class="v" id="specWater">71 %</div></div>
          <div class="spec"><div class="k">Atmosphere</div><div class="v" id="specAtm">1.0√óEarth</div></div>
          <div class="spec"><div class="k">Moons</div><div class="v" id="specMoons">1</div></div>
        </div>

        <div class="panel" style="padding:12px">
          <h2 style="margin:0 0 6px">World summary</h2>
          <p class="sub" id="summary" style="margin:0">
            A temperate terrestrial world with generous oceans and Earth‚Äëlike gravity‚Äîpromising for human exploration.
          </p>
        </div>
      </div>
    </aside>
  </main>

  <footer>¬© 2025 GoldenSpaceAI ‚Äî Have fun world‚Äëbuilding.</footer>

<script>
  // --- Helpers
  const $ = (id)=>document.getElementById(id);
  const fmt = (n)=>n.toLocaleString();

  function clamp(v,min,max){ return Math.min(max, Math.max(min,v)); }

  function updatePreview(){
    const name = $('name').value.trim() || 'Unnamed World';
    const type = $('type').value;
    const radius = +$('radius').value;
    const temp = +$('temp').value;
    const water = +$('water').value;
    const atmRel = +$('atm').value / 100; // rel to Earth
    const grav = +$('grav').value / 100;  // g
    const moons = +$('moons').value;
    const rings = +$('rings').value === 1;

    $('radiusVal').textContent = fmt(radius);
    $('tempVal').textContent = temp;
    $('waterVal').textContent = water;
    $('atmVal').textContent = (atmRel.toFixed(2)) + '√óEarth';
    $('gravVal').textContent = grav.toFixed(2);
    $('moonsVal').textContent = moons;
    $('ringsVal').textContent = rings ? 'Yes' : 'No';

    $('specName').textContent = name;
    $('specType').textContent = type;
    $('specRadius').textContent = fmt(radius)+' km';
    $('specGrav').textContent = grav.toFixed(2)+' g';
    $('specTemp').textContent = temp+' ¬∞C';
    $('specWater').textContent = water+' %';
    $('specAtm').textContent = (atmRel.toFixed(1))+'√óEarth';
    $('specMoons').textContent = moons;

    drawPlanet({type, water, temp, rings, moons});

    $('summary').textContent = makeSummary({name,type,radius,temp,water,atmRel,grav,moons,rings});
  }

  function makeSummary(p){
    const tempFeel = p.temp < -50 ? 'frigid' :
                     p.temp < 0   ? 'icy' :
                     p.temp < 25  ? 'temperate' :
                     p.temp < 60  ? 'warm' : 'scorching';

    const waterNote = p.water > 80 ? 'an oceanic surface' :
                      p.water > 50 ? 'broad blue seas' :
                      p.water > 20 ? 'patchy seas and continents' :
                      p.water > 0  ? 'scattered inland seas' : 'no surface water';

    const habit = (p.type.includes('Gas') || p.type.includes('Neptune')) ? 'uninhabitable without floating habitats'
                : (p.grav < 0.6 || p.grav > 1.8 || p.atmRel < 0.5) ? 'challenging for long‚Äëterm humans'
                : 'potentially habitable with preparation';

    const adorn = (p.rings ? 'adorned with pale rings, ' : '') + (p.moons ? `orbiting with ${p.moons} moon${p.moons===1?'':'s'}.` : 'lonely in space.');

    return `${p.name} is a ${tempFeel} ${p.type.toLowerCase()} world with ${waterNote}. Gravity is ` +
      `${p.grav.toFixed(2)} g and air mass ~${p.atmRel.toFixed(1)}√ó Earth. It appears ${habit}, ${adorn}`;
  }

  // Atmosphere sliders must sum ~100
  function syncAtmo(){
    const n2 = +$('n2').value, o2 = +$('o2').value, tr = +$('trace').value;
    $('n2Val').textContent = n2; $('o2Val').textContent = o2; $('traceVal').textContent = tr;
    const sum = n2 + o2 + tr;
    const warn = $('atmoWarn');
    if (sum !== 100){
      warn.textContent = `Atmosphere totals ${sum}%. Adjust sliders to make 100%.`;
      warn.style.color = sum>100 ? 'var(--bad)' : 'var(--warn)';
    } else {
      warn.textContent = 'Balanced atmosphere.';
      warn.style.color = 'var(--good)';
    }
  }

  // Draw planet preview on canvas
  function drawPlanet({type, water, temp, rings, moons}){
    const c = $('planet'), ctx = c.getContext('2d');
    const W = c.width, H = c.height, R = Math.min(W,H)*0.36;
    ctx.clearRect(0,0,W,H);

    // background stars
    ctx.fillStyle = '#080c12';
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle = 'rgba(255,255,255,.9)';
    for(let i=0;i<200;i++){
      const x=Math.random()*W, y=Math.random()*H, r=Math.random()*1.2;
      ctx.globalAlpha = Math.random()*0.8;
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 1;

    const cx=W/2, cy=H/2;

    // rings
    if (rings){
      ctx.save();
      ctx.translate(cx,cy);
      ctx.rotate(-15*Math.PI/180);
      const inner=R*1.15, outer=R*1.75;
      const grd = ctx.createLinearGradient(-outer,0,outer,0);
      grd.addColorStop(0,'rgba(245,197,66,.05)');
      grd.addColorStop(0.5,'rgba(245,197,66,.25)');
      grd.addColorStop(1,'rgba(245,197,66,.05)');
      ctx.strokeStyle = grd; ctx.lineWidth = outer-inner;
      ctx.beginPath(); ctx.ellipse(0,0,(inner+outer)/2,(inner+outer)/2*0.54,0,0,Math.PI*2);
      ctx.stroke();
      ctx.restore();
    }

    // planet sphere with slight terminator
    const grd = ctx.createRadialGradient(cx-R*0.5, cy-R*0.8, R*0.2, cx, cy, R*1.2);
    const base = (type.includes('Gas')||type.includes('Neptune')) ? '#5aa0ff'
               : (type.includes('Desert')||type.includes('Lava')) ? '#c07a3a'
               : (type.includes('Ice')) ? '#a6d3f3'
               : '#4c7a5a';
    grd.addColorStop(0, base);
    grd.addColorStop(1, '#0a0f15');
    ctx.fillStyle = grd;
    ctx.beginPath(); ctx.arc(cx,cy,R,0,Math.PI*2); ctx.fill();

    // oceans
    if (!type.includes('Gas') && !type.includes('Neptune')){
      const ocean = clamp(water/100,0,1);
      ctx.save();
      ctx.beginPath(); ctx.arc(cx,cy,R-1,0,Math.PI*2); ctx.clip();
      ctx.fillStyle = 'rgba(38,139,210,'+(0.65*ocean)+')';
      ctx.fillRect(cx-R, cy-R*ocean, R*2, R*2*ocean);
      // simple land texture
      ctx.globalAlpha = 0.35;
      ctx.fillStyle = '#2e5938';
      for(let i=0;i<80*ocean;i++){
        const rx = cx + (Math.random()*2-1)*R*0.9;
        const ry = cy + (Math.random()*2-1)*R*0.9;
        const rr = Math.random()*8+2;
        ctx.beginPath(); ctx.arc(rx,ry,rr,0,Math.PI*2); ctx.fill();
      }
      ctx.restore();
      ctx.globalAlpha = 1;
    }

    // moons
    for(let i=0;i<moons;i++){
      const ang = (i/moons)*(Math.PI*2) + 0.6;
      const dist = R*1.9;
      const mx = cx + Math.cos(ang)*dist;
      const my = cy + Math.sin(ang)*dist;
      ctx.fillStyle = '#c9d1d9';
      ctx.beginPath(); ctx.arc(mx,my, R*0.12, 0, Math.PI*2); ctx.fill();
      ctx.strokeStyle = 'rgba(255,255,255,.12)';
      ctx.beginPath(); ctx.arc(cx,cy, dist, 0, Math.PI*2); ctx.stroke();
    }
  }

  function currentPlanet(){
    return {
      name: $('name').value.trim() || 'Unnamed World',
      type: $('type').value,
      radius_km: +$('radius').value,
      temperature_c: +$('temp').value,
      water_pct: +$('water').value,
      atmosphere_rel_earth: +$('atm').value/100,
      gravity_g: +$('grav').value/100,
      moons: +$('moons').value,
      has_rings: +$('rings').value===1,
      atmosphere: {
        N2: +$('n2').value,
        O2: +$('o2').value,
        other: +$('trace').value
      },
      summary: $('summary').textContent
    };
  }

  function exportJSON(){
    const blob = new Blob([JSON.stringify(currentPlanet(), null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = (currentPlanet().name.replace(/\s+/g,'_')||'planet') + '.json';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  }

  function randomize(){
    $('type').selectedIndex = Math.floor(Math.random()*$('type').options.length);
    $('radius').value = Math.floor(1500 + Math.random()*68500);
    $('temp').value = Math.floor(-150 + Math.random()*550);
    $('water').value = Math.floor(Math.random()*101);
    $('atm').value = Math.floor(40 + Math.random()*220);
    $('grav').value = Math.floor(40 + Math.random()*220);
    $('moons').value = Math.floor(Math.random()*9);
    $('rings').value = Math.random() < 0.35 ? 1 : 0;

    // random atmosphere close to 100%
    let n2 = Math.floor(50 + Math.random()*40);
    let o2 = Math.floor(Math.random()* (100-n2));
    let tr = 100 - n2 - o2;
    $('n2').value = n2; $('o2').value = o2; $('trace').value = tr;
    $('name').value = ['Auralis','Karelia','Vesper','Nerith','Solenne','Draco','Lumen','Talos'][Math.floor(Math.random()*8)] + ' ' + (Math.floor(Math.random()*900)+100);

    syncAtmo(); updatePreview();
  }

  function resetDefaults(){
    $('name').value = 'Auralis Prime';
    $('type').value = 'Terrestrial';
    $('radius').value = 6371;
    $('temp').value = 15;
    $('water').value = 71;
    $('atm').value = 100;
    $('grav').value = 100;
    $('moons').value = 1;
    $('rings').value = 0;
    $('n2').value = 78; $('o2').value = 21; $('trace').value = 1;
    syncAtmo(); updatePreview();
  }

  // Init
  syncAtmo();
  updatePreview();
</script>
</body>
</html>
