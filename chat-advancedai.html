<!DOCTYPE html>
<html lang="en">  
<head>  
  <meta charset="utf-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <title>GoldenSpaceAI Â· Advanced Assistant</title>  
  <!-- keep all your styles exactly the same -->  
  <style>
    /* ... your existing CSS unchanged ... */
  </style>
</head>  
<body>  
  <div class="stars"></div>  
  <div class="twinkle"></div>  

  <div class="wrap">  
    <header>  
      <div class="brand"><div class="logo"></div><span>GoldenSpaceAI</span></div>  
      <span class="badge">Advanced Assistant</span>  
      <div class="spacer"></div>  
      <button id="themeToggle" class="toggle" type="button" title="Toggle theme">ðŸŒž Light</button>  
    </header>  

    <main id="chat">  
      <div class="msg ai">  
        <small>GoldenSpaceAI</small>  
        Choose a mode from the ï¼‹ button: <strong>Deep Search</strong>, <strong>Study & Learn</strong>, or use the <strong>Mic</strong>. Iâ€™ll tailor my responses accordingly.  
      </div>  
    </main>  

    <div class="composer-wrap">  
      <div class="composer">  
        <button id="plusBtn" type="button" class="btn plus" title="Menu"></button>  
        <div style="flex:1">  
          <textarea id="prompt" placeholder="Type your messageâ€¦ (Shift+Enter for newline)"></textarea>  
        </div>  
        <button id="micBtn" type="button" class="btn mic" title="Voice mode"></button>  
        <button id="sendBtn" type="button" class="btn send" title="Send"></button>  
      </div>  

      <div id="menu" class="menu">  
        <button data-mode="deep">ðŸ”Ž Deep Search</button>  
        <button data-mode="study">ðŸ“š Study & Learn</button>  
        <div class="sep"></div>  
        <button id="menuMic">ðŸŽ¤ Mic</button>  
      </div>  
    </div>  
  </div>  

<script>
  const BACKEND_URL = "/chat-advanced-ai"; 
  const TRANSCRIBE_URL = "/api/transcribe"; 
  const MODEL = "gpt-4o";                   

  const chat = document.getElementById("chat");
  const plusBtn = document.getElementById("plusBtn");
  const micBtn = document.getElementById("micBtn");
  const menuMicBtn = document.getElementById("menuMic");
  const promptEl = document.getElementById("prompt");
  const sendBtn = document.getElementById("sendBtn");
  const menu = document.getElementById("menu");
  const themeToggle = document.getElementById("themeToggle");

  let currentMode = "deep"; 

  /* THEME */
  const savedTheme = localStorage.getItem("gsai:theme") || "light";  
  applyTheme(savedTheme);  
  themeToggle.addEventListener("click", ()=>{  
    const next = document.body.classList.contains("theme-dark") ? "light" : "dark";  
    applyTheme(next);  
  });  
  function applyTheme(mode){  
    if(mode==="dark"){  
      document.body.classList.add("theme-dark");  
      themeToggle.textContent = "ðŸŒ™ Dark";  
      localStorage.setItem("gsai:theme","dark");  
    }else{  
      document.body.classList.remove("theme-dark");  
      themeToggle.textContent = "ðŸŒž Light";  
      localStorage.setItem("gsai:theme","light");  
    }  
  }  

  /* HELPERS */
  function el(tag, attrs={}, ...children){  
    const n = document.createElement(tag);  
    Object.entries(attrs).forEach(([k,v])=>{  
      if(k==="class") n.className=v;  
      else if(k==="html") n.innerHTML=v;  
      else n.setAttribute(k,v);  
    });  
    children.forEach(c=> n.append(c instanceof Node? c : document.createTextNode(c)));  
    return n;  
  }  
  function addMsg(role, text){  
    const m = el("div",{class:`msg ${role}`});  
    m.append(el("small",{}, role==="user"?"You":"GoldenSpaceAI"));  
    const body = el("div",{html:(text||"").toString().replace(/\n/g,"<br/>")});  
    m.append(body);  
    chat.append(m); chat.scrollTop = chat.scrollHeight;  
    return m;  
  }  
  function addSpinner(){  
    const row = el("div",{class:"msg ai"}); 
    row.append(el("small",{},"GoldenSpaceAI")); 
    row.append(el("div",{class:"spinner"}));  
    chat.append(row); chat.scrollTop = chat.scrollHeight;   
    return row;  
  }  

  /* MENU */
  plusBtn.addEventListener("click", ()=>{  
    menu.style.display = (menu.style.display==="flex"?"none":"flex");  
    menu.style.flexDirection = "column";  
  });  

  menu.querySelectorAll("button[data-mode]").forEach(btn=>{  
    btn.addEventListener("click",()=>{  
      currentMode = btn.dataset.mode;  
      addMsg("ai", `Mode set to: <strong>${btn.textContent}</strong>`);  
      menu.style.display="none";  
    });  
  });  

  menuMicBtn.addEventListener("click", ()=>{  
    menu.style.display="none";  
    startStopRecording();  
  });  

  /* SEND */
  async function send(){  
    const text = (promptEl.value||"").trim();  
    if(!text) return;  
    addMsg("user", text);  
    const spin = addSpinner();  
    try{  
      const res = await fetch(BACKEND_URL, { 
        method:"POST", 
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({ 
          q: text, 
          model: MODEL, 
          mode: currentMode, 
          system: buildSystemForMode(currentMode) 
        }) 
      });  
      if(!res.ok) throw new Error("Backend error: "+res.status);  
      const data = await res.json();  
      chat.removeChild(spin);  
      addMsg("ai", data.answer || data.reply || "[No reply]");  
    }catch(err){  
      chat.removeChild(spin);  
      addMsg("ai","âš ï¸ "+err.message);  
    }finally{  
      promptEl.value="";  
    }  
  }  

  function buildSystemForMode(mode){  
    if(mode==="deep"){  
      return "You are an advanced professional assistant. Perform deep reasoning and deliver a structured, thorough answer.";  
    }  
    if(mode==="study"){  
      return "You are a master teacher. Explain step-by-step with analogies and clear examples.";  
    }  
    return "You are a helpful, professional assistant.";  
  }  

  sendBtn.addEventListener("click", ()=>send());  
  promptEl.addEventListener("keydown", (e)=>{  
    if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); send(); }  
  });  
</script>  
</body>  
</html>
