<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GoldenSpaceAI ¬∑ Advanced Assistant</title>
<style>
:root{
  --gold1:#ffd700;--gold2:#ffea63;--text:#f3f6ff;
  --bubble-ai:rgba(12,12,16,.65);
  --bubble-user:linear-gradient(180deg,rgba(255,215,0,.12),rgba(255,215,0,.08));
  --border:rgba(255,255,255,.08);
}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,sans-serif;
  background-color:#05060a;
  background-image:
    url("https://goldenspaceai.space/wallpaper.png"),
    radial-gradient(1200px 800px at 75% -20%, rgba(255,215,0,.08), transparent 40%),
    radial-gradient(800px 600px at 10% 120%, rgba(255,215,0,.05), transparent 45%);
  background-repeat:no-repeat;
  background-size:cover;
  background-attachment:fixed;
  color:var(--text);
  display:flex;flex-direction:column;height:100vh;
}

/* HEADER */
header{
  display:flex;align-items:center;gap:.8rem;
  background:rgba(0,0,0,.65);padding:14px 18px;
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(8px);
  box-shadow:0 2px 10px rgba(0,0,0,.3);
}
.logo{width:32px;height:32px;border-radius:50%;
  background:conic-gradient(from 210deg,var(--gold1),var(--gold2));}
.badge{font-size:.8rem;background:linear-gradient(180deg,var(--gold1),var(--gold2));
  color:#1a1300;padding:4px 10px;border-radius:999px;font-weight:700;}

/* CHAT */
main{flex:1;overflow-y:auto;padding:16px 18px 140px;}
.msg{max-width:min(760px,90%);padding:10px 14px;border-radius:14px;margin:6px 0;
  line-height:1.45;border:1px solid var(--border);}
.msg.user{margin-left:auto;background:var(--bubble-user);}
.msg.ai{background:var(--bubble-ai);}
.msg small{display:block;opacity:.6;font-size:.75rem;margin-bottom:3px}
.tools{margin-top:6px;display:flex;gap:6px}
.speak-btn{
  background:linear-gradient(180deg,var(--gold1),var(--gold2));
  color:#141209;border:none;border-radius:8px;padding:4px 10px;font-weight:700;cursor:pointer;
}
.spinner{width:18px;height:18px;border-radius:50%;border:2px solid rgba(255,255,255,.2);
  border-top-color:var(--gold1);animation:spin 1s linear infinite;margin:auto;}
@keyframes spin{to{transform:rotate(360deg)}}

/* INPUT AREA */
.composer-wrap{position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:center;
  padding:12px;background:rgba(0,0,0,.55);backdrop-filter:blur(8px);border-top:1px solid var(--border);}
.composer{width:min(960px,95%);display:flex;flex-direction:column;gap:8px;}
textarea#prompt{flex:1;resize:none;min-height:52px;max-height:140px;padding:10px 14px;
  border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,.05);
  color:var(--text);font-size:15px;line-height:1.4;}
.actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;}
.act-btn{
  flex:1 1 140px;max-width:160px;text-align:center;padding:12px 0;
  background:rgba(255,215,0,.08);border:1px solid rgba(255,215,0,.3);
  color:var(--gold1);border-radius:14px;font-weight:700;cursor:pointer;
  transition:.2s;box-shadow:0 0 10px transparent;
}
.act-btn.active{
  background:linear-gradient(45deg,var(--gold1),var(--gold2));
  color:#1a1300;box-shadow:0 0 20px rgba(255,215,0,.4);
}
.act-btn:hover{background:rgba(255,215,0,.15);}

/* GOLDEN LOCK */
#lockOverlay{
  position:fixed;inset:0;display:none;justify-content:center;align-items:center;
  background:rgba(0,0,0,0.78);backdrop-filter:blur(18px);
  z-index:9999;color:#fff;text-align:center;padding:30px;
  animation:fadeIn .5s ease-out;
}
@keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.lock-box{
  background:linear-gradient(145deg,rgba(18,18,22,0.95),rgba(10,10,15,0.9));
  border:2px solid rgba(255,215,0,.45);border-radius:22px;
  padding:40px 35px;box-shadow:0 0 40px rgba(255,215,0,.25);
  max-width:440px;width:92%;
}
.lock-icon{font-size:3.5rem;color:gold;text-shadow:0 0 20px rgba(255,215,0,.6);
  animation:pulseLock 2s infinite ease-in-out;}
@keyframes pulseLock{0%,100%{transform:scale(1);opacity:1;}50%{transform:scale(1.1);opacity:.9;}}
.lock-title{font-size:1.9rem;font-weight:800;color:gold;margin-top:10px;
  text-shadow:0 0 8px rgba(255,215,0,.5);}
.lock-desc{margin:18px 0 28px;color:#ddd;font-size:1rem;line-height:1.6;}
.unlock-btn{
  background:linear-gradient(45deg,var(--gold1),var(--gold2));color:#141200;border:none;
  font-size:1.1rem;font-weight:700;padding:14px 40px;border-radius:12px;cursor:pointer;
  transition:all .3s ease;box-shadow:0 0 25px rgba(255,215,0,.35);
}
.unlock-btn:hover{transform:translateY(-2px);box-shadow:0 0 40px rgba(255,215,0,.5);}
.lock-msg{margin-top:14px;font-size:.9rem;color:#ccc;}
</style>
</head>
<body>
<header>
  <div class="logo"></div><strong>GoldenSpaceAI</strong><span class="badge">Advanced Assistant</span>
</header>

<div id="lockOverlay">
  <div class="lock-box">
    <div class="lock-icon">üîí</div>
    <div class="lock-title">Golden Access</div>
    <div class="lock-desc">
      Unlock <b>Advanced AI Chat</b> for <b>10 G / month</b><br>
      Enjoy Deep Think (GPT-5-mini), Image Generation, File Analysis & Voice Chat.
    </div>
    <button class="unlock-btn" id="unlockBtn">Unlock for 10 G</button>
    <div id="lockMsg" class="lock-msg"></div>
  </div>
</div>

<main id="chat">
  <div class="msg ai"><small>GoldenSpaceAI</small>
    Welcome to Advanced Chat ‚Äî type a message or use the tools below.
  </div>
</main>

<div class="composer-wrap">
  <div class="composer">
    <textarea id="prompt" placeholder="Type your message‚Ä¶ (Shift + Enter = newline)"></textarea>
    <div class="actions">
      <button class="act-btn" id="deepBtn">Deep Think</button>
      <button class="act-btn" id="imgBtn">Generate Image</button>
      <button class="act-btn" id="uploadBtn">Upload File</button>
      <button class="act-btn" id="micBtn">Voice</button>
      <button class="act-btn" id="sendBtn">Send</button>
    </div>
  </div>
</div>

<script>
const chat=document.getElementById("chat"),promptEl=document.getElementById("prompt");
const deepBtn=document.getElementById("deepBtn"),imgBtn=document.getElementById("imgBtn"),
uploadBtn=document.getElementById("uploadBtn"),micBtn=document.getElementById("micBtn"),
sendBtn=document.getElementById("sendBtn"),BACKEND="/chat-advanced-ai";
let currentMode=null,fileData=null,recording=false,recorder,chunks=[];

/* ===== UNLOCK SYSTEM ===== */
async function checkAccess(){
  const r=await fetch("/api/feature-status?feature=chat_advancedai");
  const j=await r.json();
  document.getElementById("lockOverlay").style.display=j.unlocked?"none":"flex";
}
document.getElementById("unlockBtn").onclick=async()=>{
  const m=document.getElementById("lockMsg");
  m.textContent="Processing...";
  const r=await fetch("/api/unlock-feature",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({feature:"chat_advancedai",cost:10})});
  const j=await r.json();
  if(j.success){m.textContent="‚úÖ Unlocked!";setTimeout(()=>location.reload(),1000);}
  else m.textContent="‚ùå "+(j.error||"Failed");
};
checkAccess();

/* ===== HELPERS ===== */
function addMsg(role,text){
  const m=document.createElement("div");
  m.className="msg "+role;
  m.innerHTML=`<small>${role==="user"?"You":"GoldenSpaceAI"}</small><div>${text.replace(/\n/g,"<br>")}</div>`;
  if(role==="ai"){
    const t=document.createElement("div");t.className="tools";
    const speak=document.createElement("button");speak.className="speak-btn";speak.textContent="üîä Speak";
    speak.onclick=()=>{const u=new SpeechSynthesisUtterance(text);speechSynthesis.speak(u);};
    t.appendChild(speak);m.appendChild(t);
  }
  chat.appendChild(m);chat.scrollTop=chat.scrollHeight;
}
function spinner(){const s=document.createElement("div");s.className="spinner msg ai";
  chat.appendChild(s);chat.scrollTop=chat.scrollHeight;return s;}
function activate(btn){[deepBtn,imgBtn,uploadBtn,micBtn].forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");currentMode=btn.id;}
function deactivateAll(){[deepBtn,imgBtn,uploadBtn,micBtn].forEach(b=>b.classList.remove("active"));
  currentMode=null;fileData=null;}

/* ===== BUTTONS ===== */
deepBtn.onclick=()=>activate(deepBtn);
imgBtn.onclick=()=>activate(imgBtn);
uploadBtn.onclick=()=>{
  const inp=document.createElement("input");inp.type="file";
  inp.onchange=e=>{fileData=e.target.files[0];activate(uploadBtn);};inp.click();
};
micBtn.onclick=async()=>{
  if(!recording){
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    recorder=new MediaRecorder(stream);chunks=[];
    recorder.ondataavailable=e=>chunks.push(e.data);
    recorder.onstop=async()=>{
      const blob=new Blob(chunks,{type:"audio/webm"});const fd=new FormData();
      fd.append("audio",blob,"speech.webm");
      const r=await fetch("/api/transcribe",{method:"POST",body:fd});
      const j=await r.json();promptEl.value=j.text||"";deactivateAll();
    };
    recorder.start();recording=true;micBtn.classList.add("active");
  }else{recorder.stop();recording=false;}
};

/* ===== SEND ===== */
sendBtn.onclick=async()=>{
  const text=promptEl.value.trim();if(!text)return;
  addMsg("user",text);const spin=spinner();
  const fd=new FormData();let model="gpt-4o";
  if(currentMode==="deepBtn")model="gpt-5-mini";
  if(currentMode==="imgBtn")model="gpt-image-1";
  if(fileData)fd.append("image",fileData);
  fd.append("q",text);fd.append("model",model);
  const r=await fetch(BACKEND,{method:"POST",body:fd});
  const j=await r.json();chat.removeChild(spin);
  if(model==="gpt-image-1"&&j.reply.startsWith("data:image"))
    addMsg("ai",`<img src="${j.reply}" style="max-width:100%;border-radius:12px;">`);
  else addMsg("ai",j.reply||j.error||"[No reply]");
  deactivateAll();promptEl.value="";
};
promptEl.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendBtn.click();}
});
</script>
</body>
</html>
